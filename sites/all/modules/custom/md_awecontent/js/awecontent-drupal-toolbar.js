(function(a){AWEContent.Views.DrupalToolbar=AWEContent.Views.Toolbar.extend({id:"drupal-elements",template:_.template('<div class="obj-adjust">                <div class="awe-element-filter select-list toggle-drop">                    <div class="list-item">                        <div class="crr-item">                            <span class="dis-change">All<span class="ati-quantity"></span></span>                            <i class="ic ac-icon-arrow-down"></i><input type="hidden" value="template-all" name="selected_value">                        </div>                        <ul class="content-drop">                            <li class="select-template" data-value="*">All<span class="ati-quantity"></span></li>                            <li class="select-template" data-value="fields">Fields <span class="ati-quantity"></span></li>                        </ul>                    </div>                </div>                <div class="awe-drupal-items scroll-bar"><ul class="all-element"></ul></div>            </div> '),filterItemTemplate:_.template('<li class="select-template" data-value="<%= module %>">                <%= moduleName %> Module <span class="ati-quantity">(<%= blockQuantity %>)</span>            </li>'),itemTemplate:_.template('<li class="item-element ac-dp-<%= type %> <%= module %>" data-type="drupal_<%= type %>">                <span><%= name %></span>            </li>'),loadedElements:[],initToolbar:function(){AWEContent.Views.Toolbar.prototype.initToolbar.call(this);this.getToolbarContent()},renderController:function(){return'<a href="#drupal-elements"><i class="ic ac-icon-drupal"></i>Drupal</a>'},render:function(){this.$el.append(this.template())},getToolbarContent:function(){var c=this,d=a(".awecontent-body-wrapper input[name=form_id]").val(),b=d?d.trim().replace("_node_form",""):"";a.post(AWEContent.Path.drupalElementURL,{type:"drupal_elements_controller",node_type:b},function(e){if(e.status){a.each(e.data.blocks,function(g,f){a("ul.content-drop",c.$el).append(c.filterItemTemplate({moduleName:f.name,blockQuantity:this.blocks.length,module:g}));a.each(f.blocks,function(){var i=JSON.stringify({delta:this.delta,module:this.module,info:this.info}),h=a(c.itemTemplate({module:this.module,name:this.info,type:"block"}));h.addClass(this.module+"-"+this.delta).attr("data-template",i);a("ul.all-element",c.$el).append(h)})});a(".content-drop li[data-value=fields] span.ati-quantity",c.$el).text("("+Object.keys(e.data.fields).length+")");a.each(e.data.fields,function(){var f=JSON.stringify({fieldName:this.field_name,nodeType:this.bundle,entityType:this.entity_type}),g=a(c.itemTemplate({module:"fields",name:this.label,type:"field"}));g.addClass("field-"+this.field_name).attr("data-template",f);a("ul.all-element",c.$el).append(g)});a(".select-list",c.$el).aweSelect().bind("change",function(){var f=a("input[name=selected_value]",a(this)).val();a("li.item-element",c.$el).show();if(f!="*"){a("li.item-element:not(."+f+")",c.$el).hide()}a(".scroll-bar",c.$el).perfectScrollbar("update")});a("ul.all-element",c.$el).mouseenter(function(){var g=AWEContent.contentIframe.height(),f=AWEContent.contentIframe.scrollTop();a(".awecontent-wrapper").height(g);a(window).scrollTop(f)});a("ul.all-element > li.item-element",c.$el).draggable({iframeFix:true,refreshPositions:true,helper:"clone",start:function(f,g){a(".scroll-bar",c.$el).addClass("position-default");g.helper.css("z-index",9999)},stop:function(f,g){a(".scroll-bar",c.$el).removeClass("position-default")}});a(".scroll-bar",c.$el).perfectScrollbar().scroll(function(){var g=a(this),f=parseInt(a(".ps-scrollbar-y-rail",g).css("top"));a("li.item-element:not(.ui-draggable-dragging, .ui-sortable-helper)",g).draggable("option","cursorAt",{top:f})}).trigger("scroll");a.each(c.loadedElements,function(){a("li.item-element."+this,c.$el).addClass("loaded").attr("style","")});a(window).resize(function(){AWEContent.iframe.height(a(window).height())}).trigger("resize");AWEContent.Panels.toolbarPanel.updateSortableColumn()}})},hideController:function(b){this.loadedElements.push(b);if(this.initialized){a("li.item-element."+b,this.$el).addClass("loaded").removeAttr("style")}},showController:function(b){this.loadedElements.splice(a.inArray(b,this.loadedElements),1);if(this.initialized){a("li.item-element."+b,this.$el).removeClass("loaded")}},resetToolbar:function(){this.loadedElements=[];a("li.item-element.loaded",this.$el).removeClass("loaded")}});a(document).ready(function(){AWEContent.Toolbars.drupal=new AWEContent.Views.DrupalToolbar()})})(jQuery);