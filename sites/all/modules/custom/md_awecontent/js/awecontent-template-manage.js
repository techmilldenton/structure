(function(e){var a=false,d=null;function b(){e(".awecontent-body-wrapper").show();e("body").awecontent("disable").removeClass("awecontent-active")}function f(g){AWEContent.templateType=Drupal.settings.aweTemplateType;if(!a){e("body").awecontent({pageURL:AWEContent.Path.layoutURL,sections:g,sectionsWrapper:"#awe-section-wrapper",pageWrapper:"body",sectionAlwaysFluid:Drupal.settings.sectionsFullWidth,disableAuto:false,closeBuilderCallback:function(h){if(h){var i=d?JSON.parse(e(".ac-template-data",d).val().trim()):{title:""};if(Drupal.settings.aweTemplateType=="section"){AWEContent.templateDialog.savedElement=e(".awe-section:eq(0)",AWEContent.sectionsView.$el);i.data=h[0]}else{AWEContent.templateDialog.savedElement=AWEContent.sectionsView.$el;i.data=h}AWEContent.templateDialog.open(i)}else{b()}}});a=true}else{e("body").awecontent("openBuilder",g)}e(".awecontent-body-wrapper").hide();e("body").addClass("awecontent-active");e(window).bind("aweBuilderOpen",function(h){if(Drupal.settings.aweTemplateType=="section"){AWEContent.iframe.contents().find("div.add-section").remove();AWEContent.Toolbars.template.allowDragTemplate=false;AWEContent.iframe.contents().find("body").addClass("awe-build-section")}})}function c(i,j){var h=_.template('<div class="ac-tpl-item">                    <div class="template-item">                        <div class="template-preview">                            <a href="#" class="prvimg"><img alt="" src="<%= template.thumbnail %>"></a>                            <ul class="template-control">                                    <li class="delete-control"><a href="#"><i class="ic ac-icon-trash"></i></a></li>                                    <li class="copy-control"><a href="#"><i class="ic ac-icon-clone"></i></a></li>                                    <li class="edit-control"><a href="#"><i class="ic ac-icon-edit"></i></a></li>                                    <% if (type == "section") { %>                                    <li class="favourite-control"><a href="#"><i class="ic ac-icon-star"></i></a></li>                                    <% } %>                                </ul>                        </div>                        <div class="template-entry">                            <div class="template-entry-col">                                <h3 class="template-title"><%= template.title %></h3>                            </div>                                <textarea class="ac-template-data" style="display: none"><%= JSON.stringify(template) %></textarea>                        </div>                    </div>                </div>')({template:i,type:Drupal.settings.aweTemplateType}),g=e(h);if(i.category){g.addClass(i.category)}else{g.addClass("custom own-template")}if(i.favourite){g.addClass("favourite")}if(j){e("#ac-items-wrapper").append(g)}else{e("#ac-items-wrapper").prepend(g)}}e(document).ready(function(){AWEContent.Path=Drupal.settings.awePathConfigurations;e("body").append('<div class="awecontent-body-wrapper"></div>');e(".awecontent-body-wrapper").append(e("body").children(":not(.awecontent-body-wrapper)"));e("body").append(e("#save-template-dialog"));e("a.add-template-btn, a.add-new-section").click(function(g){g.preventDefault();d=null;f([])});e("#filters").delegate(".template-filter a","click",function(h){h.preventDefault();var g=e(this).attr("data-filter");e(".template-filter > li.active").removeClass("active");e(this).parent("li").addClass("active");e("#ac-items-wrapper .ac-tpl-item").removeClass("ac-disable");if(g!="*"){e("#ac-items-wrapper .ac-tpl-item:not("+g+")").addClass("ac-disable")}});e(window).bind("aweUploadTemplateSuccess",function(h,g){if(d){e(".template-preview img",d).attr("src",g.thumbnail);e(".template-title",d).html(g.title);e(".ac-template-data",d).val(JSON.stringify(g))}else{c(g,false)}b()});e(".page-template").delegate("ul.template-control > li > a","click",function(j){j.preventDefault();var h=e(this).parents(".ac-tpl-item"),i=JSON.parse(e(".ac-template-data",e(this).parents(".ac-tpl-item")).val().trim());if(e(this).parent().hasClass("delete-control")){if(i&&confirm(Drupal.t("This template will be deleted permanently. Are you sure?"))){e.post(AWEContent.Path.templateActionURL,{tid:i.tid,act:"remove"},function(k){if(k.status){h.remove()}else{alert(Drupal.t("Delete template unsuccessful."))}})}}else{if(e(this).parent().hasClass("copy-control")){e.post(AWEContent.Path.templateActionURL,{tid:i.tid,act:"clone",type:Drupal.settings.aweTemplateType},function(k){if(k.status){c(k.template,false)}else{alert(k.msg)}})}else{if(e(this).parent().hasClass("edit-control")){d=h;i=JSON.parse(i.data);i=Drupal.settings.aweTemplateType=="section"?[i]:i;f(i)}else{if(e(this).parent().hasClass("favourite-control")){var g=h.hasClass("favourite")?0:1;e.post(AWEContent.Path.templateActionURL,{tid:i.tid,act:"favourite",favourite:g},function(k){if(k.status){if(g){h.addClass("favourite")}else{h.removeClass("favourite")}}else{alert(Drupal.t("Update favourite unsuccessful.",{},null))}})}}}}});e("a.load-more").click(function(h){h.preventDefault();var g=e(this).parent(),i=e(".page-template > .template-row > .ac-tpl-item").length;e.post(window.location.href,{currentTemplates:i,act:"loadTemplates"},function(j){if(!j.loadMore){g.hide()}if(j.templates.length){e.each(j.templates,function(l,k){c(k,true)});e(".template-filter > li.active > a").trigger("click")}})})})})(jQuery);