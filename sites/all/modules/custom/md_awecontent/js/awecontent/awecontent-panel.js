(function(a){AWEContent.Views.DefaultPanel=Backbone.View.extend({initialized:false,editingModel:null,panelName:"",panelEvents:{},events:function(){return a.extend({"click .op-top > .toggle-build":"togglePanel"},this.panelEvents)},initialize:function(){this.isOpenned=false},addPanelToDoc:function(){this.$el.attr("id",this.panelName+"-panel").data("name",this.panelName);a(".panel-list").append(this.$el)},render:function(c){if(this.panelName){this.$el.append(c.html);var b=document.createElement("script");b.type="text/javascript";b.text=c.js;document.body.appendChild(b)}},initPanel:function(){var b=this;a(".close-panel",this.$el).click(function(c){c.preventDefault();b.closePanel()});a(".scroll-bar",this.$el).perfectScrollbar()},setPanelElementsValue:function(){},buildPanel:function(){return{}},editModel:function(c){var b=this;this.editingModel=c;if(this.editingModel){this.$el.data("model.id",c.cid)}if(!this.initialized){this.addPanelToDoc();this.getPanelHTML()}this.openPanel()},closePanel:function(){this.isOpenned=false;this.$el.removeClass("opened");if(!this.$el.hasClass("child-panel")){this.$el.parent().removeClass("opened")}if(this.editingModel){AWEContent.contentIframe.find(".awe-model-"+this.editingModel.cid).removeClass("awe-active")}AWEContent.panelsOpened-=1;if(AWEContent.panelsOpened==0){AWEContent.$pageWrapper.removeClass("panel-open");AWEContent.contentIframe.find(".awe-section").trigger("resize",{closePanel:true,openPanel:false});a(window).trigger("resize");AWEContent.jqIframe(AWEContent.windowIframe).trigger("resize")}AWEContent.$pageWrapper.trigger("awePanelClose",AWEContent.panelsOpened)},openPanel:function(){var c=this;if(AWEContent.panelsOpened==0){a(window).trigger("resize");AWEContent.jqIframe(AWEContent.windowIframe).trigger("resize")}AWEContent.panelsOpened+=1;if(!this.initialized){var b=setInterval(function(){if(c.initialized){clearInterval(b);c.setPanelElementsValue()}},100)}else{this.setPanelElementsValue()}this.isOpenned=true;a(".top-index",this.$el.parents(".awe-panel")).removeClass("top-index");if(!this.$el.hasClass("child-panel")){a(".awe-obj-panel.opened",this.$el.parent()).each(function(){var d=a(this).data("name");AWEContent.Panels[d].closePanel()})}this.$el.addClass("opened top-index");this.$el.parent().addClass("opened");if(this.editingModel){AWEContent.contentIframe.find(".awe-active").removeClass("awe-active");AWEContent.contentIframe.find(".awe-model-"+this.editingModel.cid).addClass("awe-active")}AWEContent.$pageWrapper.addClass("panel-open");AWEContent.contentIframe.find(".awe-section").trigger("resize",{closePanel:false,openPanel:true});a(".scroll-bar",this.$el).perfectScrollbar("update");AWEContent.$pageWrapper.trigger("awePanelOpen",AWEContent.panelsOpened)},togglePanel:function(b){if(this.$el.hasClass("opened")){this.closePanel(b)}else{this.openPanel(b)}},getPanelHTML:function(){var b=this;this.$el.append('<div class="awe-panel-preload"></div>');a.post(AWEContent.Path.buildPanel,{name:this.panelName,data:this.buildPanel()},function(c){if(c){switch(a.type(c)){case"string":c=JSON.parse(c.trim());break;case"object":break;default:c=[];break}}else{c=[]}if(c[b.panelName]){b.render(c[b.panelName])}b.initPanel();b.initialized=true;a(".awe-panel-preload",b.$el).remove()})}});AWEContent.Views.MediaPanel=AWEContent.Views.DefaultPanel.extend({className:"awe-obj-panel child-panel media-panel",panelName:"mediaPanel",panelEvents:{"click .awe-item-upload":"chooseUploadedFile","click .close-panel":"closePanel","click .js-select-lib-media":"chooseLibraryFile"},initPanel:function(){AWEContent.Views.DefaultPanel.prototype.initPanel.call(this);var b=this;a(".library",b.el).data({initialized:0});a(".md-tab",this.$el).tabs({active:0,activate:function(c,d){if(a("> .library",d.newPanel).data("url")&&!a("> .library",d.newPanel).data("initialized")){a("> .library",d.newPanel).aweLibraryInit()}}})},openPanel:function(){AWEContent.Views.DefaultPanel.prototype.openPanel.call(this);a(".awe-buildzone").addClass("overlay-iframe");a(".awe-item-upload",this.$el).remove()},closePanel:function(){AWEContent.Views.DefaultPanel.prototype.closePanel.call(this);a(".awe-buildzone").removeClass("overlay-iframe")},changeMediaFile:function(d,c){this.editModel(null);this.$controller=d;var b=this,e=setInterval(function(){if(!b.initialized){return}clearInterval(e);a(".book-lib").removeClass("borrowed");if(c){b.multiUpload=1;a(".md-tab",b.$el).data("multi-upload",1)}else{b.multiUpload=0;a(".md-tab",b.$el).data("multi-upload",0)}},100)},chooseUploadedFile:function(e){var c=a(e.target).hasClass("awe-item-upload")?a(e.target):a(e.target).parents(".awe-item-upload"),b=a("input[name=file_data]",c).val().trim(),d=this.multiUpload?[JSON.parse(b)]:JSON.parse(b);if(this.$controller.hasClass("awe-background-element")){a(".img-bg",this.$controller).css("background-image","url("+d.file_url+")");a("input[name=selected_media]",this.$controller).val(JSON.stringify(d)).trigger("change")}else{if(this.$controller.hasClass("thumb-image")){this.$controller.find("input[name=selected_media]").val(JSON.stringify(d)).trigger("change",{action:"library",data:d})}else{a("input[name=selected_media]",this.$controller).val(JSON.stringify(d)).trigger("change")}}this.closePanel()},chooseLibraryFile:function(d){var b=a(".book-lib.borrowed",a(d.target).parent());if(b.length==0){a(".awe-media-message",a(this).parent()).html("No file selected.")}else{if(this.multiUpload){var c=[];a.each(b,function(g,e){var f=a("input",this).val().trim();if(f){c.push(JSON.parse(f))}})}else{if(a("input",b).val()){var c=JSON.parse(a("input",b).val())}}if(this.$controller.hasClass("awe-background-element")){a(".img-bg",this.$controller).css("background-image","url("+encodeURI(c.file_url)+")");a("input[name=selected_media]",this.$controller).val(JSON.stringify(c)).trigger("change")}else{if(this.$controller.hasClass("thumb-image")){this.$controller.find("input[name=selected_media]").val(JSON.stringify(c)).trigger("change",{action:"library",data:c})}else{a("input[name=selected_media]",this.$controller).val(JSON.stringify(c)).trigger("change")}}}this.closePanel()},buildPanel:function(){return{title:{type:"markup",markup:'<div class="awe-title"><h2>Upload</h2></div>'},upload_section:{type:"section",awe_media_upload:{type:"media_upload",upload_url:AWEContent.Path.fileUploadURL,accept_types:["jpg","jpeg","png","gif"],library_options:{url:AWEContent.Path.libraryURL},my_file_options:{url:AWEContent.Path.myFileURL}}}}}});AWEContent.Views.AttributesPanel=AWEContent.Views.DefaultPanel.extend({className:"awe-obj-panel child-panel attribute-panel",panelName:"customAttributesPanel",attrTemplate:_.template('<div class="item-cus-data">            <div class="aw-norm">                <i class="ic ac-icon-move"></i>                <span class="filldata">                    <span class="dataadd"><%= attr %></span>=”<span class="datavalue"><%= attr_value %></span>”                </span>                <div class="fl-right">                    <span class="edit-cur-data"><i class="ic ac-icon-edit"></i></span>                    <span class="rem-item-data"><i class="ic ac-icon-trash"></i></span>                </div>            </div>            <div class="js-update-attr add-data">                <form>                    <div class="aw-input" style="display: none">                        <label for="awe-update-attr-name-<%= index %>">Value</label>                        <input id="awe-update-attr-name-<%= index %>" type="text" value="<%= attr %>" class="attr-name">                    </div>                    <div class="aw-input">                        <label for="awe-update-attr-value-<%= index %>">Value</label>                        <input id="awe-update-attr-value-<%= index %>" type="text" value="<%= attr_value %>" class="attr-value">                    </div>                </form>                <button class="save-cur-data">Save</button>                <button class="can-item-data">Cancel</button>            </div>        </div>'),panelEvents:{"click .add-attr":"addAttribute","click .edit-cur-data":"editAttrElement","click .rem-item-data":"removeAttrElement","click button.can-item-data":"closeEditAttrForm","click button.save-cur-data":"updateAttrElement"},initPanel:function(){AWEContent.Views.DefaultPanel.prototype.initPanel.call(this);var b=this;a(".cus-datasection",this.$el).sortable({items:".item-cus-data",axis:"y",update:function(){b.changeAttributesData(true)}})},validateAttrName:function(b){return b.match(/[A-Za-z][-A-Za-z0-9_]*/)&&a.inArray(b,this.dataAtttributes)===-1},changeAttributes:function(b){this.editModel(null);this.$controller=b;var e=this,d=a("input[name=attributes_data]",this.$controller).val(),c;c=setInterval(function(){if(e.initialized){clearInterval(c);a(".cus-datasection",this.$el).empty();e.dataAtttributes=[];if(d){d=JSON.parse(d);a.each(d,function(g,f){a(".cus-datasection",e.$el).append(e.attrTemplate({attr:f.attrName,attr_value:f.attrValue,index:g}));e.dataAtttributes.push(f.attrName)})}}},50)},addAttribute:function(){var d=a("#awe-add-attr-name",this.$el).val(),b=a("#awe-add-attr-value",this.$el).val(),c=a(".item-cus-data",this.$el).length+1;if(d&&this.validateAttrName(d)&&b){a(".cus-datasection",this.$el).append(this.attrTemplate({attr:d,attr_value:b,index:c}));a("#awe-add-attr-name",this.$el).val("");a("#awe-add-attr-value",this.$el).val("");this.dataAtttributes.push(d);this.changeAttributesData(false,{action:"addAttr",data:{attrName:d,attrValue:b}})}},editAttrElement:function(c){var b=a(c.target).parents(".item-cus-data");a("> .add-data",b).toggleClass("edit")},removeAttrElement:function(c){var b=a("input.attr-name",a(c.target).parents(".item-cus-data")).val();a(c.target).parents(".item-cus-data").remove();this.changeAttributesData(false,{action:"rmAttr",data:{attrName:b}})},closeEditAttrForm:function(b){a("> .add-data",a(b.target).parents(".item-cus-data")).removeClass("edit")},updateAttrElement:function(e){var c=a(e.target).parents(".item-cus-data"),d=a("form .attr-name",c).val(),b=a("form .attr-value",c).val();if(b){a("span.datavalue",c).text(b);this.closeEditAttrForm(e);this.changeAttributesData(false,{action:"updateAttr",data:{attrName:d,attrValue:b}})}},changeAttributesData:function(b,d){var c=[];a(".cus-datasection > .item-cus-data",this.$el).each(function(f,e){var g=a("form input.attr-name",e).val(),h=a("form input.attr-value",e).val();c.push({attrName:g,attrValue:h})});a("input[name=attributes_data]",this.$controller).val(JSON.stringify(c));if(!b){a("input[name=attributes_data]",this.$controller).trigger("change",d)}},buildPanel:function(){return{title:{type:"markup",markup:'<div class="awe-title"><h2>Custom attributes</h2></div>'},form_section:{type:"section",add_form:{type:"markup",markup:'<div class="add-data"><form><div class="aw-input"><label for="awe-add-attr-value">Name</label><input id="awe-add-attr-name" class="namedata" type="text" placeholder="Attribute name"></div><div class="aw-input"><label for="awe-add-attr-value">Value</label><input id="awe-add-attr-value" class="valdata" type="text" placeholder="Attribute value"></div></form></div><div class="add-attr"><button><i class="ic ac-icon-add"></i>Add attribute</button></div>'}},attributes_section:{type:"section",attributes:{"class":["nobor"]},attr_wrap:{type:"markup",markup:'<div class="cus-datasection"></div>'}}}}});AWEContent.Views.AnimationPanel=AWEContent.Views.DefaultPanel.extend({className:"awe-obj-panel child-panel animation-panel",panelName:"customAnimationsPanel",panelEvents:{"click .accept-animation":"acceptAnimation","click .pull-open":"previewAnimation","click .cancel-animation":"closePanel"},initPanel:function(){AWEContent.Views.DefaultPanel.prototype.initPanel.call(this);var b=this;this.animationCurrent={};this.animationBefore={};a("#customanimationspanel-animation-list",this.el).change(function(e,d){var c=d.value;a(this).closest(".select-list").nextAll("[data-rx]").hide();a(this).closest(".select-list").nextAll("[data-rx="+c+"]").show();if(c=="none"){a("#customanimationspanel-duration, #customanimationspanel-delay, .pull-open",b.el).hide()}else{a("#customanimationspanel-duration, #customanimationspanel-delay, .pull-open",b.el).show()}})},editAnimation:function(c){this.editModel(null);this.$controller=c;var b=this,d=this.$controller.aweAnimation("value").animations;console.log(d);if(a.type(d)=="string"){if(d==""){d={type:"none"}}else{d=a.parseJSON(d.trim())}}this.currentAnimation=d;this.prevAnimation=d;this.itemAnimation=d;var e=setInterval(function(){if(b.initialized){clearInterval(e);b.resetForm();a("#customanimationspanel-animation-list",b.el).aweSelect("value",d.type);if(d.duration){a("#customanimationspanel-duration",b.el).aweSlider("value",d.duration)}if(d.delay){a("#customanimationspanel-delay",b.el).aweSlider("value",d.delay)}switch(d.type){case"spinin":a("#customanimationspanel-spinin-direction",b.el).aweSelect("value",d.advance.direction);a("#customanimationspanel-spinin-round",b.el).aweSlider("value",d.advance.numberOfSpin);break;case"flyin":a("#customanimationspanel-flyin-options",b.el).aweSelect("value",d.advance);break;case"turnin":a("#customanimationspanel-turnin-direction",b.el).aweSelect("value",d.advance);break}}},50)},previewAnimation:function(){this.changeAnimationData();var b=this.$controller.aweAnimation("value").previewEl;a("> .awe-item",b).processAnimations(this.animationCurrent,this.animationBefore)},changeAnimationData:function(b){this.animationBefore=this.animationCurrent;var c={type:a("#customanimationspanel-animation-list input[name=selected_value]",this.el).val(),duration:a("#customanimationspanel-duration .display-font",this.el).text(),delay:a("#customanimationspanel-delay .display-font",this.el).text(),};this.animationCurrent=c;return c},acceptAnimation:function(b){var c=this.changeAnimationData();this.$controller.aweAnimation("value",{animations:JSON.stringify(c)});this.closePanel()},closePanel:function(b){AWEContent.Views.DefaultPanel.prototype.closePanel.call(this);if(b){a("input[name=enabled_custom_animation]",this.$controller).attr("data-animations",this.itemAnimation)}},resetForm:function(){var b=this,d=500,c=0;a("#customanimationspanel-duration",b.el).aweSlider("value",d);a("#customanimationspanel-delay",b.el).aweSlider("value",c)},buildPanel:function(){return{title:{type:"markup",markup:'<div class="awe-title"><h2>Appear animation</h2></div>'},animation_section:{type:"section",animation_list:{type:"select",title:"Choose animation",options:{none:"None",bounceIn:"bounceIn",bounceInDown:"bounceInDown",bounceInLeft:"bounceInLeft",bounceInRight:"bounceInRight",bounceInUp:"bounceInUp",fadeIn:"fadeIn",fadeInDown:"fadeInDown",fadeInDownBig:"fadeInDownBig",fadeInLeft:"fadeInLeft",fadeInLeftBig:"fadeInLeftBig",fadeInRight:"fadeInRight",fadeInRightBig:"fadeInRightBig",fadeInUp:"fadeInUp",fadeInUpBig:"fadeInUpBig",flipInX:"flipInX",flipInY:"flipInY",lightSpeedIn:"lightSpeedIn",rotateIn:"rotateIn",rotateInDownLeft:"rotateInDownLeft",rotateInDownRight:"rotateInDownRight",rotateInUpLeft:"rotateInUpLeft",rotateInUpRight:"rotateInUpRight",slideInUp:"slideInUp",slideInDown:"slideInDown",slideInLeft:"slideInLeft",slideInRight:"slideInRight",zoomIn:"zoomIn",zoomInDown:"zoomInDown",zoomInLeft:"zoomInLeft",zoomInRight:"zoomInRight",zoomInUp:"zoomInUp",rollIn:"rollIn",},default_value:"none"},animation_time:{type:"list_box",duration:{type:"slider",title:"Duration",unit:"ms",allow_type:true,step:100,min_value:0,max_value:10000,widget:"slider",default_value:"500"},delay:{type:"slider",title:"Delay",unit:"ms",allow_type:true,min_value:0,max_value:5000,step:100,widget:"slider",default_value:"0"}},preview:{type:"markup",markup:'<div class="pull-open"><span class="title-tag">Preview animation</span><div><i class="ic ac-icon-play"></i></div></div>'},animation_controls:{type:"markup",markup:'<input type="button" class="accept-animation" value="OK"><input type="button" class="cancel-animation" value="Cancel">'}}}}});AWEContent.Views.FontPanel=AWEContent.Views.DefaultPanel.extend({className:"awe-obj-panel child-panel font-panel",panelName:"fontPanel",panelEvents:{"click ul.fonts-list > li":"chooseFont","mouseover ul.fonts-list > li":"hoverChangeFont"},template:_.template('<li data-value="<%= dataValue %>" class="js-font-select <%= classFont %>">                <span class="font-name"><%= dataValue %></span>            </li>'),initPanel:function(){a(".tab-font .scroll-bar",this.$el).perfectScrollbar();this.getGoogleFont();a(".tab-font",this.$el).tabs({active:0})},getGoogleFont:function(){var c=this,b=a(".list-google-font",c.el),d=b.length>0?a(".js-link",b).val().trim().split("="):[],f=(d[1])?d[1].split("|"):[],e=a(".fonts-list",b);a.each(f,function(j,i){var l=i.split(":"),g=l[0].replace(/\+/g," "),h=l.length>1?l[1]:"400",k=g.replace(/ /g,"");e.append(a(c.template({dataValue:g,classFont:k})).attr("font-weight",h))});a(".tab-font .scroll-bar",this.$el).perfectScrollbar("update")},chooseFont:function(e){var c=this,f=a(e.target).hasClass("js-font-select")?a(e.target):a(e.target).closest(".js-font-select"),d=f.data("value"),b=f.attr("font-weight");a("#tab-recent-font .fonts-list",c.$el).append(f.clone());c.closePanel({name:d,fontStyles:b})},hoverChangeFont:function(e){var c=this,b=a(e.target).hasClass("js-font-select")?a(e.target):a(e.target).closest(".js-font-select"),d=b.data("value");c.$controller.trigger("change",[{name:d,previewFont:true}])},changeFont:function(b){this.editModel(null);this.$controller=b},buildPanel:function(){return{panel_html:{type:"markup",theme:"ac_panel_font",parameters:{path:window.location.pathname,font:(AWEContent.google_font&&AWEContent.google_font!==undefined)?AWEContent.google_font:""}}}},closePanel:function(b){if(this.$controller){this.$controller.trigger("change",[b])}AWEContent.Views.DefaultPanel.prototype.closePanel.call(this)},getFontData:function(c){var b=a('#tab-all-font li.js-font-select[data-value="'+c+'"]',this.$el);return{name:c,text:a("span.font-name",b).text(),fontWeight:b.attr("font-weight")?b.attr("font-weight"):"400,700"}}});AWEContent.Views.ListIconsPanel=AWEContent.Views.DefaultPanel.extend({className:"awe-obj-panel child-panel lib-icon-panel",panelName:"listIconPanel",panelEvents:{"click .close-panel":"closePanel","click .item-icon":"selectIcon"},initialize:function(){AWEContent.Views.DefaultPanel.prototype.initialize.call(this)},initPanel:function(){var b=this;a(".control-ok",b.$el).click(function(){b.nameIcon=b.$controller.attr("data-name-icon");b.closePanel()});a(".control-cancel",b.$el).click(function(){b.closePanel()});a(".tab-icon",b.$el).tabs();a(".scroll-bar",this.$el).perfectScrollbar({})},closePanel:function(){AWEContent.Views.DefaultPanel.prototype.closePanel.call(this);this.$controller.trigger("change",{nameIcon:this.nameIcon})},processIcon:function(b){this.editModel(null);this.$controller=b;this.nameIcon=this.$controller.attr("data-name-icon")},selectIcon:function(c){var b=a(c.target).hasClass("item-icon")?a(c.target):a(c.target).parent(),d=a("i",b).attr("class");this.$controller.attr("data-name-icon",d).trigger("change",{nameIcon:d})},buildPanel:function(){return{panel_html:{type:"markup",theme:"ac_panel_icon"}}}})})(jQuery);