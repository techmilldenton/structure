(function(a){AWEContent.Models.ColumnSettings=Backbone.RelationalModel.extend({bgImageURL:"",defaults:{customID:"",customClass:"",centerVertical:0,textAlign:"text-left",enableMinHeight:1,minHeight:-1,bgColor:"",bgFid:-1,bgImage:"",bgMode:"repeat",bgPosition:"center center",enableScrolling:0,enabledBgOverlay:0,bgOverlayColor:"",boxModelSettings:{},lgResponsive:true,xsResponsive:true,mediumResponsive:true,smResponsive:true},relations:[{type:Backbone.HasOne,key:"boxModelSettings",relatedModel:AWEContent.Models.BoxModelSettings}]});AWEContent.Models.BootstrapGrid=Backbone.RelationalModel.extend({defaults:{"col-lg":12,"col-md":12,"col-sm":12,"col-xs":12,"col-lg-offset":0,"col-md-offset":0,"col-sm-offset":0,"col-xs-offset":0,"col-lg-make-row":false,"col-md-make-row":false,"col-sm-make-row":false,"col-xs-make-row":false}});AWEContent.Models.Column=Backbone.RelationalModel.extend({defaults:{classes:{},hasLayout:0,layout:[],items:[],settings:{}},relations:[{type:Backbone.HasOne,key:"classes",relatedModel:AWEContent.Models.BootstrapGrid},{type:Backbone.HasOne,key:"settings",relatedModel:AWEContent.Models.ColumnSettings}],clone:function(){var b=new AWEContent.Collections.ListItem(),c=new AWEContent.Collections.ListColumn();if(!this.get("hasLayout")){this.get("items").each(function(d){b.add(d.clone())})}else{this.get("layout").each(function(d){c.add(d.clone())})}return new AWEContent.Models.Column({settings:this.get("settings").toJSON(),classes:this.get("classes").toJSON(),items:b,hasLayout:this.get("hasLayout"),layout:c})},removePanelView:function(){var b=this.toJSON();if(b.hasLayout){this.get("layout").each(function(c){c.removePanelView()})}else{a.each(this.get("items").toArray(),function(){this.removePanelView()})}}});AWEContent.Collections.ListColumn=Backbone.Collection.extend({model:AWEContent.Models.Column});AWEContent.Views.Column=Backbone.View.extend({tagName:"div",className:"awe-col",template:_.template('<div class="awe-custom custom-wrap">                <ul>                    <li class="js-edit-column cus-edit"><i class="ic ac-icon-edit"></i></li>                    <li class="js-split-column cus-split"><i class="ic ac-icon-split"></i></li>                    <li class="js-clone-column cus-clone"><i class="ic ac-icon-clone"></i></li>                    <li class="js-delete-column"><i class="ic ac-icon-trash"></i></li>                    <li class="col-cus-show-more ">                        <i class="ic ac-icon-ellipsis-h"></i>                        <ul class="col-cus-more-contain">                            <li class="js-decrease-offset cus-prev cus-res-mode"><i class="ic ac-icon-moveleft"></i></li>                            <li class="js-increase-offset cus-next cus-res-mode"><i class="ic ac-icon-moveright"></i></li>                            <li class="cus-creat-col js-toggle-layout"><i class="ic ac-icon-sublayout"></i></li>                            <li class="js-make-row cus-res-mode cus-make"><i class="ic ac-icon-newline"></i></li>                            <li class="cus-res-mode js-edit-hide"><i class="ic ac-icon-eye"></i></li>                        </ul>                    </li>                </ul>            </div>            <div class="awe-col-content"></div>'),events:{"click > .custom-wrap > ul > li > ul > .js-increase-offset":"changeOffset","click > .custom-wrap > ul > li > ul > .js-decrease-offset":"changeOffset","click > .custom-wrap > ul > li > ul > .js-edit-hide":"showHideElement","click > .custom-wrap > ul > .js-delete-column":"destroy","click > .custom-wrap > ul > .js-edit-column":"editColumn","click > .custom-wrap > ul > .js-split-column":"splitColumn","click > .custom-wrap > ul > li > ul > .js-make-row":"makeNewRow","click > .custom-wrap > ul > li > ul > .js-toggle-layout":"toggleColumnLayout","click > .custom-add-layout":"addColumnToColumnLayout","click > .custom-wrap > ul > .js-clone-column":"cloneColumn"},initialize:function(){var b=this;this.render();this.checkBlankColumn();this.renderColumnContent();this.listenTo(this.model.get("settings"),"change",this.renderChangeColumnSettings);this.listenTo(this.model.get("settings").get("boxModelSettings"),"change",this.renderChangeColumnSettings);this.listenTo(this.model.get("classes"),"change",this.renderChangeColumnClasses);if(!this.model.get("hasLayout")){this.listenTo(this.model.get("items"),"all",this.checkBlankColumn)}this.$el.bind("getImageURLSuccess",function(d,c){})},processBackgroundURL:function(d,g,f,e){var c=this.model.toJSON().settings,b=e&&e[c.bgFid]&&e[c.bgFid]["none"]?e[c.bgFid]["none"]:"";this.model.bgImageURL=b;this.processBackground(c,a("> .awe-col-content",this.el))},checkBlankColumn:function(){if((this.model.get("items")==undefined||!this.model.get("items").length)&&!this.model.get("hasLayout")){this.$el.addClass("awe-blank")}else{this.$el.removeClass("awe-blank")}},initResizable:function(){var c=this,d,b;b=setInterval(function(){var g=AWEContent.jqIframe(".awe-model-"+c.model.cid),e=g.parent();if(e){var f=(e.width())?parseInt(e.width()/12):1;AWEContent.jqIframe(".awe-model-"+c.model.cid).resizable({handles:"e",containment:"parent",grid:[f,f],start:function(h,i){i.element.css({padding:0});d=i.element.parent().parent().parent().height()},resize:function(i,j){var h=j.element.parent().parent().parent();if(h.height()!=d){a(h.get(0)).trigger("resize");d=h.height()}a(this).css("height","")},stop:function(i,q){var o=q.element.parent().parent().parent(),h=AWEContent.jqIframe(c.el).resizable("option","grid")[0],j=Math.round((q.size.width-q.originalSize.width)/h),k=c.$el.attr("class"),m=AWEContent.Toolbars.responsive.classScreen,n=c.model.get("classes").get(m+"-offset"),p=c.model.get("classes").get(m),l=p+j;if(n+l>12){l=12-n}else{if(l<1){l=1}}k=k.replace(m+"-"+p,m+"-"+l);c.$el.removeClass().addClass(k).css({width:"",padding:""});c.model.get("classes").set(m,l);if(o.height()!=d){a(o.get(0)).trigger("resize")}}});clearInterval(b)}},100)},afterChangeClassColumn:function(){if(this.model.get("hasLayout")){this.model.get("layout").each(function(d,c){d.view.afterChangeClassColumn()})}var b=this.model.get("items");if(b.length){b.each(function(c,d){c.view.$el.trigger("resize")})}this.autoSetNewRow();this.refreshColumnGrid()},refreshColumnGrid:function(){AWEContent.Toolbars.responsive.updateColumnResizeGrid()},autoSetNewRow:function(d){var c=this,b=c.model.collection,e=AWEContent.Toolbars.responsive.classScreen;b.each(function(k,g){var h=k.get("classes").get(e);for(var j=g-1;j>=0;j--){var m=b.at(j),l=m.view.$el,f=m.get("classes").get(e);if(l.css("clear")=="both"){j=-1;h+=f}else{h+=f}}if(l!=undefined){if(h>12){k.view.$el.css("clear","both")}else{k.view.$el.css("clear","")}}})},generateColumnClasses:function(){var b=[];a.map(this.model.get("classes").toJSON(),function(d,c){if(c=="column"){return}b.push(c+"-"+d)});return b.join(" ")},render:function(){var b=this;this.$el.append(this.template()).addClass(this.generateColumnClasses());this.renderColumnSettings();this.$el.addClass("awe-model-"+b.model.cid);this.initResizable();setTimeout(function(){b.renderDefaultColumnClasses();b.autoSetNewRow();var c=b.model.collection.at(0).view.$el,d=a(">.awe-custom > ul > .js-delete-column",c),e=a(">.awe-custom > ul > .js-split-column",b.el),f=a(">.awe-custom > ul >.col-cus-show-more > ul > .js-toggle-layout",b.el);if(b.model.collection.length==1){d.addClass("disable")}else{d.removeClass("disable")}if(b.$el.hasClass("awe-has-layout")){f.addClass("disable")}if(b.$el.hasClass("col-lg-1")){e.addClass("disable")}},50)},destroy:function(g){g.preventDefault();var e=this.$el.parent().parent().parent(),f=e.height(),i=this.$el.siblings().length,c=this.model.collection;if(i){this.model.removePanelView();var d=AWEContent.Panels.column;if(d.isOpenned&&d.$el.data("model.id")==this.model.cid){d.$el.removeAttr("data-model.id");d.closePanel()}this.model.collection.remove(this.model);this.model.destroy();this.remove();setTimeout(function(){c.at(0).view.autoSetNewRow();if(e.height()!=f){e.trigger("resize")}},100)}if(c.length==1){var b=c.at(0).view.$el,h=a(">.awe-custom > ul >.js-delete-column",b);h.addClass("disable")}},editColumn:function(){AWEContent.Panels.column.editModel(this.model)},splitColumn:function(d){var g=this.model.get("classes").get("col-lg");if(g>1){var b=a(".awe-col",this.$el.parent()).index(this.$el),e=Math.ceil(g/2),f=g-e,c=new AWEContent.Models.Column({classes:new AWEContent.Models.BootstrapGrid({"col-lg":f,"col-md":f}),items:new AWEContent.Collections.ListItem()});this.model.get("classes").set({"col-lg":e,"col-md":e});this.model.collection.add(c,{at:b+1})}},makeNewRow:function(){var c=AWEContent.Toolbars.responsive.classScreen;if(this.model.collection.indexOf(this.model)!==0&&this.model.get("classes").get(c)!==12){var b=this.model.get("classes").get(c+"-make-row");this.model.get("classes").set(c+"-make-row",!b);this.$el.parents(".awe-section").trigger("resize")}},toggleColumnLayout:function(){if(this.$el.hasClass("awe-has-layout")){var f=new AWEContent.Collections.ListItem(),g=a(">.awe-custom > ul >.col-cus-show-more > ul > .js-toggle-layout",this.el);g.removeClass("disable");this.model.get("layout").each(function(i){i.get("items").each(function(j){f.add(j,{silent:true})})});this.model.set("items",f,{silent:true});this.model.unset("layout",{silent:true});var h=new AWEContent.Views.ListItem({collection:f});a(">.awe-col-content",this.$el).prepend(h.$el);a(">.awe-col-content >.awe-col-layout-wrapper",this.$el).remove();this.$el.removeClass("awe-has-layout");this.model.set("hasLayout",0);a("> .custom-add-layout",this.$el).remove();AWEContent.Panels.toolbarPanel.updateSortableColumn(a("> .awe-col-wrapper",h.$el))}else{var d=new AWEContent.Models.Column({settings:new AWEContent.Models.ColumnSettings(),classes:new AWEContent.Models.BootstrapGrid(),items:new AWEContent.Collections.ListItem()}),e=new AWEContent.Collections.ListColumn(),c=new AWEContent.Views.ListColumn({collection:e}),g=a(">.awe-custom > ul >.col-cus-show-more > ul > .js-toggle-layout",this.el);g.addClass("disable");e.add(d);this.model.get("items").each(function(i){d.get("items").add(i,{silent:true})});this.model.set("layout",e);this.model.set("hasLayout",1);this.model.unset("items",{silent:true});var b=new AWEContent.Views.ListItem({collection:d.get("items")});this.$el.addClass("awe-has-layout");c.$el.removeClass().addClass("awe-col-layout-wrapper clearfix");a(".awe-col:first > .awe-col-content >.awe-col-wrapper",c.$el).remove();a(".awe-col:first > .awe-col-content",c.$el).append(b.$el);a("> .awe-col-content",this.el).append(c.$el);this.$el.append('<div class="awe-custom custom-add-layout"><ul><li class="cus-cal-icon"><i class="ic ac-icon-add"></i></li></ul></div>');a("> .awe-col-content > .awe-col-wrapper",this.$el).remove();AWEContent.Panels.toolbarPanel.updateSortableColumn(a(".awe-col-wrapper",c.$el))}this.checkBlankColumn()},addColumnToColumnLayout:function(){var c=new AWEContent.Models.BoxModelSettings(),b=new AWEContent.Models.Column({settings:new AWEContent.Models.ColumnSettings({boxModelSettings:c}),items:new AWEContent.Collections.ListItem(),classes:new AWEContent.Models.BootstrapGrid()});this.model.get("layout").add(b)},changeOffset:function(d){var g=a(d.target);if(g.hasClass("js-increase-offset")||g.parent().hasClass("js-increase-offset")){g=(g.hasClass("js-increase-offset"))?g:g.parent()}else{g=(g.hasClass("js-decrease-offset"))?g:g.parent()}if(!g.hasClass("disabled")){var f=AWEContent.Toolbars.responsive.classScreen,e=this.model.get("classes").get(f+"-offset"),c=0,b=this.$el.attr("class");if(g.hasClass("js-increase-offset")){c=(e+1+this.model.get("classes").get(f)>12)?e:e+1}else{c=(e>0)?e-1:0}if(e!=c){b=b.replace(f+"-offset-"+e,f+"-offset-"+c);this.$el.removeClass().addClass(b);this.model.get("classes").set(f+"-offset",c)}}},showHideElement:function(){this.model.get("settings").set(AWEContent.Toolbars.responsive.screen,false);AWEContent.Toolbars.responsive.reInitPanel()},renderDefaultColumnClasses:function(){var h=this,c=h.model.toJSON().classes,d=AWEContent.Toolbars.responsive.classScreen,f=a("> .awe-custom",h.el),e=c[d+"-offset"],b=c[d],g=a(".cus-prev",f),j=a(".cus-next",f),i=a(">.awe-custom > ul > .js-split-column",h.el);if(!e){g.addClass("disable")}else{g.removeClass("disable")}if(e+b==12){j.addClass("disable")}else{j.removeClass("disable")}if(h.$el.hasClass("col-lg-1")){i.addClass("disable")}else{i.removeClass("disable")}},renderChangeColumnClasses:function(d){var b=this,e=b.$el.closest(".awe-section"),c;if(e.length){c=e.index();a.each(d.changed,function(f,i){var h=f+"-"+d.previousAttributes()[f],g=f+"-"+i;b.$el.removeClass(h).addClass(g)});b.renderDefaultColumnClasses();AWEContent.sections.at(c).set("connectSpacingToColumn",true)}b.afterChangeClassColumn()},renderColumnSettings:function(){var b=this,d=this.model.get("settings").toJSON(),e=a(" >.awe-col-content",this.$el);this.$el.addClass(d.customClass).attr("id",d.customID);b.$colOverlay=a('<div class="custom-bg-overlay custom-overlay"></div>');this.$el.aweImageURL({fid:[d.bgFid],styles:["none"],success:function(f,i,h,g){b.processBackgroundURL(f,i,h,g)}});if(d.enableMinHeight){if(d.minHeight!=-1){e.css("min-height",d.minHeight+"px");var c=setInterval(function(){if(a("> .awe-col-wrapper",e).length>0){a("> .awe-col-wrapper",e).css("min-height",d.minHeight+"px");clearInterval(c)}},50)}}if(d.bgMode=="parallax"){e.attr("data-parallax",true)}else{e.attr("data-parallax",false)}e.attr("data-scrolling",d.enableScrolling?true:false);AWEContent.jqIframe(" >.awe-col-content",b.el).parallax();if(d.enabledBgOverlay){e.prepend(b.$colOverlay);b.$colOverlay.css("background-color",d.bgOverlayColor)}e.renderItemDefaultBoxModel(d.boxModelSettings,b.$colOverlay);if(d.centerVertical){e.addClass("col-vertical-center")}e.addClass(d.textAlign);b.$el.defaultResponsive(d)},renderColumnContent:function(){var b;if(this.model.get("hasLayout")&&this.model.get("layout").length){var e=this.model.get("layout"),d=new AWEContent.Views.ListColumn({collection:e});d.$el.removeClass().addClass("awe-col-layout-wrapper clearfix");b=d.$el;this.$el.addClass("awe-has-layout");this.$el.append('<div class="awe-custom custom-add-layout"><ul><li class="cus-cal-icon"><i class="ic ac-icon-add"></i></li></ul></div>')}else{var c=new AWEContent.Views.ListItem({collection:this.model.get("items")});b=c.$el}a(">.awe-col-content",this.$el).append(b)},renderChangeColumnSettings:function(c){var b=this,d=b.model.toJSON().settings,f=a("> .awe-col-content",b.el),e=a(".custom-bg-overlay",f);a.each(c.changed,function(j,n){b.$el.changeResponsive(j,n);switch(j){case"customID":f.attr("id",d.customID);break;case"customClass":var k=b.model.get("settings").previousAttributes().customClass;b.$el.removeClass(k).addClass(d.customClass);break;case"centerVertical":n?f.addClass("col-vertical-center"):f.removeClass("col-vertical-center");break;case"textAlign":var g=b.model.get("settings").previousAttributes().textAlign;f.removeClass(g).addClass(n);break;case"enableMinHeight":case"minHeight":var m=d.minHeight!=-1?d.minHeight+"px":"",h=d.enableMinHeight;if(h){a(">.awe-col-wrapper",f).css("min-height",m)}else{a(">.awe-col-wrapper",f).css("min-height","")}break;case"heightEqual":var l=c.previousAttributes().heightEqual,i=n!=-1?n+"px":"";if(l!=n){a(">.awe-col-wrapper",f).css("min-height",i)}break;case"bgColor":case"bgFid":case"bgPosition":b.processBackground(c.toJSON(),f);break;case"bgMode":if(n=="parallax"){f.attr("data-parallax",true)}else{f.attr("data-parallax",false)}b.processBackground(c.toJSON(),f);break;case"enableScrolling":if(n){f.attr("data-scrolling",true)}else{f.attr("data-scrolling",false)}break;case"enabledBgOverlay":if(d.enabledBgOverlay){f.prepend(b.$colOverlay)}else{e.remove()}break;case"bgOverlayColor":e.css("background",d.bgOverlayColor);break;case"enabledParallax":case"enabledMouseMoveParallax":break;default:f.renderChangeSettingBoxModel(j,n,c,b.$colOverlay)}})},processBackground:function(f,e){var f=f,c="",h="",b="",d="",g=f.bgColor;if(f.bgFid>0){c="url("+encodeURI(this.model.bgImageURL)+")";if(f.bgMode=="parallax"){h="";b="fixed";d="50% 0%/cover"}else{if(f.bgMode=="fullcover"){d="center/cover";b=""}else{h=f.bgMode;d=f.bgPosition}}g+=" "+c+" "+h+" "+b+" "+d}e.css("background",g);return g},cloneColumn:function(){var c=this.model.clone(),b=this.$el.index();this.model.collection.add(c,{at:b+1})}});AWEContent.Collections.ListColumn=Backbone.Collection.extend({model:AWEContent.Models.Column});AWEContent.Views.ListColumn=Backbone.View.extend({tagName:"div",className:"row",initialize:function(){this.listenTo(this.collection,"add",this.append);this.render()},render:function(){this.collection.each(function(c,b){this.append(c)},this)},append:function(c,e,d){var b=new AWEContent.Views.Column({model:c});c.view=b;if(d&&d.at!=undefined){b.$el.insertAfter(a(".awe-col:eq("+(d.at-1)+")",this.$el))}else{this.$el.append(b.$el)}AWEContent.Panels.toolbarPanel.updateSortableColumn(a(".awe-col-wrapper",b.$el));this.$el.closest(".awe-section").trigger("resize")}})})(jQuery);