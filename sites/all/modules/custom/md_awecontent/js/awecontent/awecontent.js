(function(c){window.AWEContent={Models:{},Collections:{},Controllers:{},Panels:{},Views:{},Toolbars:{},Path:{imageStyleURL:"",fileUploadURL:"upload.php",uploadTemplate:"upload.php",templateActionURL:"load-template.php",buildPanel:"panel.php",templateProxy:"html2canvasproxy.php",twitterAPI:"tweet/api/tweet.php",libraryURL:"upload.php",myFileURL:"upload.php",defaultImage:"img/image.png",libraries:{video:{css:[],js:["https://www.youtube.com/iframe_api","js/lib/froogaloop.min.js"]},magnific:{js:["js/lib/magnific-popup.js"],css:["css/magnific-popup.css"]},owlCarousel:{js:["js/lib/owl.carousel/owl.carousel.js"],css:["js/lib/owl.carousel/owl.carousel.css","js/lib/owl.carousel/owl.theme.css","js/lib/owl.carousel/owl.transitions.css"]},googleMap:{js:["https://maps.googleapis.com/maps/api/js?v=3.exp"],css:[]},aceEditor:{js:["js/lib/aceEditor/ace.js","js/lib/aceEditor/mode-html.js","js/lib/aceEditor/theme-twilight.js","js/lib/aceEditor/worker-html.js"],css:[]}}},templateType:1};AWEContent.ajaxUpload=function(f,d,g){if(window.FormData){var h=new FormData(),e=new XMLHttpRequest(),i=c.now();h.append("awe_file",f);if(d){c.map(d,function(k,j){h.append(j,k)})}g.beforeUploadCallback(f,i);e.open("POST",g.uploadURL);e.onload=function(j){g.uploadFinishedCallback(j,f,i)};e.onprogress=function(j){g.uploadProgressCallback(j,f,i)};e.onreadystatechange=function(){if(this.readyState===4){if(this.status===200){var j=JSON.parse(this.responseText.trim());g.uploadSuccessCallback(j,i);if(j.file.is_new&&AWEContent.Panels.mediaPanel){var k=c('<div class="book-lib">                                    <i class="ic ac-icon-done"></i>                                    <img src="" alt="book">                                    <input type="hidden" name="file_data">                                </div>');c("img",k).attr("src",j.file.file_url);c("input",k).val(JSON.stringify(j.file));c(".library .books-item",AWEContent.Panels.mediaPanel.$el).prepend(k)}}else{console.log("Upload files failed!")}}}}e.send(h);return true};AWEContent.mediaValidateFileType=function(d,e){var f=d.split("/");if(e.length==0||(f[1]&&c.inArray(f[1],e)!=-1)){return true}return false};AWEContent.compressImage=function(e,l,J){l=Math.round(l);J=Math.round(J);var F=e.width,d=e.height,y=e.getContext("2d").getImageData(0,0,F,d),x=e.getContext("2d").getImageData(0,0,l,J),z=y.data,p=x.data,g=F/l,m=d/J,h=Math.ceil(g/2),n=Math.ceil(m/2);for(var C=0;C<J;C++){for(var D=0;D<l;D++){var E=(D+C*l)*4;var v=0;var H=0;var f=0;var B=0,G=0,I=0,K=0;var o=(C+0.5)*m;for(var A=Math.floor(C*m);A<(C+1)*m;A++){var s=Math.abs(o-(A+0.5))/n;var q=(D+0.5)*g;var u=s*s;for(var k=Math.floor(D*g);k<(D+1)*g;k++){var t=Math.abs(q-(k+0.5))/h;var r=Math.sqrt(u+t*t);if(r>=-1&&r<=1){v=2*r*r*r-3*r*r+1;if(v>0){t=4*(k+A*F);K+=v*z[t+3];f+=v;if(z[t+3]<255){v=v*z[t+3]/250}B+=v*z[t];G+=v*z[t+1];I+=v*z[t+2];H+=v}}}}p[E]=B/H;p[E+1]=G/H;p[E+2]=I/H;p[E+3]=K/f}}e.getContext("2d").clearRect(0,0,Math.max(F,l),Math.max(d,J));e.width=l;e.height=J;e.getContext("2d").putImageData(x,0,0);return e};AWEContent.getColumnModelContainItem=function(e){var d=e.parents(".awe-col"),g,f=null;d=c(d.get().reverse());d.each(function(o,j){var m=c(j).parent().parent().parent(),k=c("> .awe-section",m.parent()).index(m),l=c("> .awe-col",c(j).parent()).index(c(j));if(f){if(f.get("hasLayout")){f=f.get("layout").at(c(j).index())}else{var h=c(j).parents(".awe-obj").first(),n=c("> .awe-obj",h.parent()).index(h),i=f.get("items").at(n);if(i.hasContentLayout){f=i.getContentColumnModel(c(j),l)}}}else{g=AWEContent.sections.at(k);f=g.get("columns").at(l)}});return f};AWEContent.Library={loadedLibraries:[],addCSSFiles:function(d){c.each(d,function(){var e=c('<link type="text/css" rel="stylesheet" href=""/>');e.attr("href",this);AWEContent.jqIframe("head").append(e)})},addJSFiles:function(h,g,j){var e=this,i=0,f=0,d;this.doc.oldWrite=this.doc.write;this.doc.write=function(m){var o=new DOMParser(),l=o.parseFromString(m,"text/xml"),n=l.firstChild,k=e.doc.createElement("script");k.src=n.getAttribute("src");k.type="text/javascript";e.doc.getElementsByTagName("head")[0].appendChild(k);e.doc.write=e.doc.oldWrite};c.each(h,function(){var k=e.doc.createElement("script");k.setAttribute("type","text/javascript");k.setAttribute("src",this);k.onload=function(l){i++};e.doc.getElementsByTagName("head")[0].appendChild(k)});d=setInterval(function(){f++;if(f>1000){clearInterval(d);return}if(h.length==i){clearInterval(d);if(j){j()}e.loadedLibraries.push(g)}},500)},addLibrary:function(f,h,e){var d=this;this.doc=(e)?document:AWEContent.documentIframe;if(!this[f+"Loading"]&&AWEContent.Path.libraries[f]){d[f+"Loading"]=true;this.addCSSFiles(AWEContent.Path.libraries[f].css);this.addJSFiles(AWEContent.Path.libraries[f].js,f,h)}else{if(h){var g=setInterval(function(){if(c.inArray(f,d.loadedLibraries)!=-1){clearInterval(g);h()}},300)}}},reset:function(){var d=this;c.each(this.loadedLibraries,function(){d[this+"Loading"]=false});this.loadedLibraries=[]}};AWEContent.Models.BoxModelSettings=Backbone.RelationalModel.extend({defaults:{enabledCustomBorder:0,enabledConstraintBorder:1,borderTop:"0 solid",borderRight:"0 solid",borderBottom:"0 solid",borderLeft:"0 solid",enabledCustomBorderRadius:0,enabledConstraintBorderRadius:1,borderRadiusUnit:"px",borderRadiusTopLeft:0,borderRadiusTopRight:0,borderRadiusBottomLeft:0,borderRadiusBottomRight:0,enabledCustomPadding:0,enabledConstraintPadding:1,paddingUnit:"px",paddingTop:0,paddingRight:0,paddingBottom:0,paddingLeft:0,enabledCustomMargin:0,enabledConstraintMargin:1,marginUnit:"px",marginTop:0,marginRight:0,marginBottom:0,marginLeft:0}});AWEContent.createSectionFromTemplate=function(e){if(e){e.settings.boxModelSettings=new AWEContent.Models.BoxModelSettings(e.settings.boxModelSettings);var f=new AWEContent.Models.SectionSettings(e.settings),d=new AWEContent.Collections.ListColumn();c.each(e.columns,function(g,h){d.add(AWEContent.createColumnFromTemplate(h))});return new AWEContent.Models.Section({settings:f,columns:d})}return null};AWEContent.createColumnFromTemplate=function(j){var d=new AWEContent.Models.BootstrapGrid(j.classes),f=new AWEContent.Models.BoxModelSettings(j.settings.boxModelSettings),h,g=null;j.settings.boxModelSettings=f;h=new AWEContent.Models.ColumnSettings(j.settings);if(j.hasLayout){var i=new AWEContent.Collections.ListColumn();c.each(j.layout,function(k,l){i.add(AWEContent.createColumnFromTemplate(l))});g=new AWEContent.Models.Column({classes:d,hasLayout:1,layout:i,settings:h})}else{var e=new AWEContent.Collections.ListItem();c.each(j.items,function(l,k){var m=null;if(AWEContent.Controllers[k.machine_name]){m=AWEContent.Controllers[k.machine_name].createItemModel(k);if(m){e.add(m)}}});g=new AWEContent.Models.Column({classes:d,settings:h,items:e,hasLayout:0})}return g};var b=function(f,e){var d={sections:[],pageURL:"#",sectionsWrapper:"#awe-sections-wrapper",pageWrapper:"body",sectionAlwaysFluid:0,disableAuto:true,closeBuilderCallback:function(){}};this.opts=c.extend({},d,e);this.$builderWrap=null;this.$iframe=null;this.sections=null;this.sectionsView=null;this.frameReady=false;this.panelsReady=false;this.initialize()},a;b.prototype={constructor:AWEContent,initialize:function(){var d=this;if(!c("#awecontent-wrapper").length){this.$builderWrap=c('<div id="awe-preloader">                        <div class="inner">                            <div class="clock">                                <div class="minute"></div><div class="house"></div>                            </div>                            <span>Now Loading.</span>                        </div>                    </div>                    <div id="awecontent-wrapper" class="awecontent-wrapper">                        <div class="awe-buildzone"><iframe></iframe></div>                        <div class="awe-panel"><div class="panel-list"></div></div>                    </div>');c("body").prepend(this.$builderWrap);this.$iframe=c("> .awe-buildzone > iframe",this.$builderWrap).attr("src",this.opts.pageURL).load(function(){d.onFrameLoad()});this.initPanels();this.$builderWrap.bind("builderClose",function(f,e){if(d.opts.disableAuto){d.hide()}if(e){d.opts.closeBuilderCallback(AWEContent.sections.toJSON())}else{d.opts.closeBuilderCallback(false)}}).bind("builderReady",function(){c("#awe-preloader").hide();c(window).trigger("aweBuilderOpen")});c(window).resize(function(){AWEContent.iframe.height(c(window).height())})}else{this.$builderWrap=c("#awecontent-wrapper");this.$iframe=c("> .awe-buildzone > iframe",this.$builderWrap)}this.show()},show:function(){this.$builderWrap.show();c(window).scroll(function(){c(".list-template-wrapper",AWEContent.Toolbars.template.$el).trigger("mouseenter")});window.addEventListener("beforeunload",this.closePage)},hide:function(){c(".awe-panel .opened .toggle-build").trigger("click");this.$builderWrap.hide();window.removeEventListener("beforeunload",this.closePage);c(window).unbind("scroll")},onFrameLoad:function(){AWEContent.iframe=this.$iframe;AWEContent.contentIframe=AWEContent.iframe.contents();AWEContent.windowIframe=AWEContent.iframe[0].contentWindow;AWEContent.documentIframe=AWEContent.iframe[0].contentWindow.document;AWEContent.jqIframe=AWEContent.windowIframe.jQuery;AWEContent.$pageWrapper=AWEContent.contentIframe.find(this.opts.pageWrapper);AWEContent.$sectionsWrapper=AWEContent.contentIframe.find(this.opts.sectionsWrapper);AWEContent.alwaysFluid=this.opts.sectionAlwaysFluid;if(AWEContent.alwaysFluid){AWEContent.contentIframe.find("body").addClass("awe-section-100")}else{AWEContent.contentIframe.find("body").removeClass("awe-section-100")}AWEContent.$pageWrapper.addClass("awe-page-wrapper");this.initSections();AWEContent.iframe.contents().find("a.new-section").click(function(d){d.preventDefault();AWEContent.sections.createSection()});AWEContent.panelsOpened=0;c(window).trigger("resize");this.frameReady=true;this.$builderWrap.trigger("builderReady");c(AWEContent.iframe.contents()).scroll(function(){c(window).trigger("scroll")})},setPageUrl:function(d){this.opts.pageURL=d;this.$iframe.attr("src",d)},setOption:function(d){this.opts=c.extend(this.opts,d)},setSectionData:function(d){this.opts.sections=d;this.setPageUrl(this.opts.pageURL)},activeBuilder:function(d){if(c.type(d)=="array"||d instanceof AWEContent.Collections.ListSection){this.setSectionData(d)}this.show()},initPanels:function(){AWEContent.Panels.toolbarPanel=new AWEContent.Views.ToolbarPanel();c(".awe-panel",this.$builderWrap).prepend(AWEContent.Panels.toolbarPanel.$el);AWEContent.Panels.section=new AWEContent.Views.SectionPanel();AWEContent.Panels.column=new AWEContent.Views.ColumnPanel();AWEContent.Panels.fontPanel=new AWEContent.Views.FontPanel();AWEContent.Panels.listIconPanel=new AWEContent.Views.ListIconsPanel();AWEContent.Panels.mediaPanel=new AWEContent.Views.MediaPanel();AWEContent.Panels.customAttributesPanel=new AWEContent.Views.AttributesPanel();AWEContent.Panels.customAnimationsPanel=new AWEContent.Views.AnimationPanel();AWEContent.templateDialog=new AWEContent.Views.TemplateDialog()},initSections:function(){var e=this;this.resetBuilder();if(this.opts.sections instanceof AWEContent.Collections.ListSection){this.sections=this.opts.sections}else{var j=[];if(this.opts.sections.length){c.each(this.opts.sections,function(k,l){j.push(AWEContent.createSectionFromTemplate(l))})}else{var g=new AWEContent.Models.BoxModelSettings(),f=new AWEContent.Models.Column({items:new AWEContent.Collections.ListItem(),settings:new AWEContent.Models.ColumnSettings({boxModelSettings:g}),classes:new AWEContent.Models.BootstrapGrid()}),d=new AWEContent.Models.BoxModelSettings(),h=new AWEContent.Models.Section({columns:new AWEContent.Collections.ListColumn([f]),settings:new AWEContent.Models.SectionSettings({boxModelSettings:d})});j.push(h)}this.sections=new AWEContent.Collections.ListSection(j)}AWEContent.sections=this.sections;AWEContent.sectionsView=this.sectionsView=new AWEContent.Views.ListSection({collection:this.sections,el:AWEContent.$sectionsWrapper});AWEContent.Panels.toolbarPanel.updateSortableColumn();if(!AWEContent.ajaxPanels){var i=[];c.map(AWEContent.Panels,function(k,l){if(AWEContent.Controllers[l]&&!AWEContent.Controllers[l].existingElement){c("#all-element ul.all-element",e.$el).append(AWEContent.Controllers[l].$el)}i.push({name:l,data:k.buildPanel()})})}},resetBuilder:function(){this.sections=null;this.frameReady=false;AWEContent.Library.reset();if(this.sectionsView){this.sectionsView.$el.empty()}},closePage:function(d){var f="All change on page builder will be lost permanently.";(d||window.event).returnValue=f;return f}};c.fn.awecontent=function(f,d){if(this.is("body")){if(typeof f=="string"){var e=Array.prototype.slice.call(arguments,1);if(a){var h=a[f];switch(f){case"setPageURL":if(e[0]){if(c.type(e[0])=="string"){a.setPageUrl(e[0])}else{throw new Error("PageURL is not a string.")}}else{throw new Error("PageURL is not set.")}break;case"option":var g={};if(c.type(e[0])=="object"){g=e[0]}else{if(c.type(e[0])=="string"&&e[1]!=undefined){g[e[0]]=e[1]}else{throw Error("Can not set option value")}}a.setOption(g);break;case"setSectionsData":if(e[0]){if(c.type(e[0])=="array"||e[0] instanceof AWEContent.Collections.ListSection){a.setSectionData(e[0])}else{throw new Error("Section data is not array. This type of sections data must be array or AWEContent.Collections.ListSection object.")}}else{a.setSectionData([])}break;case"openBuilder":a.activeBuilder(e[0]);break;case"disable":a.hide();break;default:throw new Error("AWEContentBuilder: no such method: '"+f+"'")}}else{throw new Error("Error: cannot call methods on awecontent prior to initialization;")}return this}a=new b(c(this),f);return this}else{throw new Error("Selected element is not body tag. This plugin accepts body tag only.")}}})(jQuery);