(function(a){AWEContent.Views.ToolbarPanel=AWEContent.Views.DefaultPanel.extend({className:"awe-toolbar layout",template:_.template('<div class="obj-bar">                <div class="op-top">                    <div class="toggle-build"><i class="ic ac-icon-arrow-right"></i></div>                </div>                <div class="select-tab sel-vertical">                    <ul></ul><span class="ef-act"></span>                </div>                <div class="op-bottom">                    <div class="tool-bar help-bar"><i class="ic ac-icon-help"></i>                        <div class="auto-midd">                            <div class="tool-tip">                                <ul>                                    <li><a href="http://youtube.com/megadrupal">Video tutorials</a></li>                                    <li><a href="http://megadrupal.com/forum/module-support/awecontent">Forums support</a></li>                                    <li><a href="http://megadrupal.com/contact">Contact us</a></li>                                </ul>                            </div>                        </div>                    </div>                    <div class="tool-bar save-build">                        <i class="ic ac-icon-done"></i>                        <div class="auto-midd">                            <div class="tool-tip">                                <ul><li class="save-template">Save</li></ul>                            </div>                        </div>                    </div>                    <div class="tool-bar close-build"><i class="ic ac-icon-clear"></i>                        <div class="auto-midd">                            <div class="tool-tip">                                <ul><li class="save-template">Cancel</li></ul>                            </div>                        </div>                    </div>                </div>            </div>            <div class="md-tab type-vertical pull-layout"><div class="md-content-tab"></div></div>'),panelEvents:{"click .save-build":"saveBuilder","click .close-build":"closeBuilder"},initialize:function(){var b=this;this.render();this.$el.tabs({beforeActivate:function(d,e){var c=e.newTab.index();a(".ef-act",e.newTab.parents(".select-tab")).css("top",c*70)}});a(".sel-vertical > ul > li",this.$el).click(function(d){d.preventDefault();if(!b.$el.hasClass("opened")){b.openPanel()}var c=a("li.ui-tabs-active",b.$el).data("toolbar.id");if(AWEContent.Toolbars[c]&&!AWEContent.Toolbars[c].initialized){AWEContent.Toolbars[c].initToolbar()}if(c=="responsive"){AWEContent.Toolbars.responsive.afterOpenCallback()}else{AWEContent.Toolbars.responsive.afterCloseCallback()}})},render:function(){var b=this;this.$el.append(this.template());a.map(AWEContent.Toolbars,function(d,c){a("> .obj-bar > .select-tab > ul",b.$el).append(a("<li>"+d.renderController()+"</li>").data("toolbar.id",c));a(".md-content-tab",b.$el).append(d.$el)})},openPanel:function(){AWEContent.Views.DefaultPanel.prototype.openPanel.call(this);a(".toggle-build > i",this.$el).removeClass("ac-icon-arrow-right").addClass("ac-icon-arrow-left");this.$el.parent().addClass("opened");a("li.ui-tabs-active",this.$el).trigger("click")},closePanel:function(){AWEContent.Views.DefaultPanel.prototype.closePanel.call(this);a(".toggle-build > i",this.$el).removeClass("ac-icon-arrow-left").addClass("ac-icon-arrow-right");this.$el.parent().removeClass("opened");var b=a("li.ui-tabs-active",this.$el).data("toolbar.id");AWEContent.Toolbars[b].afterCloseCallback()},saveBuilder:function(b){b.preventDefault();this.$el.parents(".awecontent-wrapper").trigger("builderClose",true)},closeBuilder:function(b){b.preventDefault();if(confirm("All changes in builder will be lost permanently. Do you want to close builder?")){this.$el.parents(".awecontent-wrapper").trigger("builderClose",false)}},updateSortableColumn:function(b){b=b?b:a(AWEContent.documentIframe.getElementsByClassName("awe-col-wrapper"));b.sortable({handle:".js-obj-parent-move",connectWith:".awe-col-wrapper",revert:true,placeholder:"awe-item-placeholder",refreshPositions:true,tolerance:"pointer",update:function(f,g){var h=g.item.data("type"),e=g.item.data("template")?g.item.data("template"):null;if(a.type(e)=="string"){e=JSON.parse(e)}if(h){var j=AWEContent.Controllers[h],i=j.createItemModel(e),d=AWEContent.getColumnModelContainItem(g.item);if(d){d.get("items").add(i,{at:g.item.index()});if(AWEContent.Panels[i.get("machine_name")]){AWEContent.Panels[i.get("machine_name")].editModel(i)}}}}});var c=a(AWEContent.documentIframe.getElementsByClassName("awe-col-wrapper"));a("ul.all-element > li.ui-draggable",this.$el).draggable("option","connectToSortable",c)}});AWEContent.Views.Toolbar=Backbone.View.extend({initialized:false,className:"md-tab-item",id:"",initialize:function(){this.render()},initToolbar:function(){this.initialized=true},renderController:function(){return""},render:function(){},afterOpenCallback:function(){},afterCloseCallback:function(){}});AWEContent.Views.TemplateToolbar=AWEContent.Views.Toolbar.extend({id:"folder-page",template:_.template('<div class="obj-adjust">                <div class="select-list toggle-drop">                    <div class="list-item">                        <div class="crr-item">                            <span class="dis-change">All<span class="ati-quantity"></span></span>                            <i class="ic ac-icon-arrow-down"></i><input type="hidden" value="template-all" name="selected_value">                        </div>                        <ul class="content-drop">                            <li class="select-template" data-value="*">All<span class="ati-quantity"></span></li>                            <li class="select-template" data-value="favourite">Favourite<span class="ati-quantity"></span></li>                        </ul>                    </div>                </div>                <div class="list-template-item scroll-bar">                    <div class="list-template-wrapper"></div>                </div>            </div>'),sectionTemplate:_.template('<div class="library-template-item <%= filterClass %><% if (template.favourite) { %><%= \' favourite\' %><% } %>" data-template-id="<%= template.tid %>">                <div class="lti-background"><img title="<%= template.title %>" alt="<%= template.title %>" src="<%= template.thumbnail %>"></div>                <div class="lti-option">                    <ul>                        <li class="js-remove-template"><i class="ic ac-icon-trash"></i></li>                        <li class="js-favourite-template tran-favor"><i class="ic ac-icon-star"></i></li>                    </ul>                </div>                <input type="hidden" value=\'<%= JSON.stringify(template) %>\' name="template-data">            </div>'),events:{"click li.js-remove-template":"removeTemplate","click li.js-favourite-template":"markFavouriteTemplate"},initialize:function(){AWEContent.Views.Toolbar.prototype.initialize.call(this);this.numberTemplates=0;this.allowLoadMore=false;this.loadingTemplate=false;this.allowDragTemplate=true},initToolbar:function(){AWEContent.Views.Toolbar.prototype.initToolbar.call(this);var b=this;this.$el.bind("loadTemplateSuccessful",function(d,c){a(".library-template-item",b.$el).draggable("destroy");b.numberTemplates+=c.length;a.each(c,function(){var e=this,g=e.category.toLowerCase().replace(/[^A-Za-z0-9\-]/g,"-");if(a("li.select-template[data-value="+g+"]",b.$el).length==0){var f=a('<li class="select-template"></li>');f.attr("data-value",g).html(e.category+'<span class="ati-quantity"></span>');a("ul.content-drop",b.$el).append(f)}a(".list-template-wrapper",b.$el).append(b.sectionTemplate({filterClass:g,template:e}))});b.initDragTemplate();a(".scroll-bar",b.$el).perfectScrollbar("update").trigger("scroll");b.loadingTemplate=false});this.$el.bind("uploadTemplateSuccess",function(d,c){a(".library-template-item",b.$el).draggable("destroy");a(".list-template-item",b.$el).prepend(b.sectionTemplate({filterClass:"custom",template:c}));b.initDragTemplate();a(".scroll-bar",b.$el).perfectScrollbar("update").trigger("scroll");b.numberTemplates+=1});a(".scroll-bar",b.$el).perfectScrollbar().scroll(function(){var d=a(".ps-scrollbar-y-rail",a(this)),f=parseInt(d.css("top"));a(".library-template-item:not(.ui-draggable-dragging, .ui-sortable-helper)",a(this)).draggable("option","cursorAt",{top:f});if(b.allowLoadMore&&!b.loadingTemplate){var g=d.height(),e=a(".ps-scrollbar-y",d),h=parseInt(e.css("top")),c=e.height();if(g-c-h<=10){b.loadTemplate()}}});a(".list-template-wrapper",this.$el).mouseenter(function(){var d=AWEContent.contentIframe.height(),c=AWEContent.contentIframe.scrollTop();a(".awecontent-wrapper").height(d);a(window).scrollTop(c)});a(".select-list",this.$el).aweSelect().change(function(d,c){a(".list-template-item .library-template-item",b.$el).show();if(c.value!="*"){a(".list-template-item .library-template-item:not(."+c.value+")",b.$el).hide()}a(".scroll-bar",b.$el).perfectScrollbar("update").trigger("scroll")});this.$el.delegate(".library-template-item","mousedown",function(){AWEContent.$sectionsWrapper.sortable("enable")}).delegate(".library-template-item","mouseup",function(){AWEContent.$sectionsWrapper.sortable("disable")});a(window).bind("aweUploadTemplateSuccess",function(e,d){d.category=d.category?d.category:"Custom";var c=a(b.sectionTemplate({filterClass:"custom",template:d}));a(".list-template-item",b.$el).prepend(c);b.initDragTemplate(c)});this.loadTemplate()},loadTemplate:function(){var b=this;this.loadingTemplate=true;a.post(AWEContent.Path.templateActionURL,{act:"load_templates",current:this.numberTemplates,type:"section"},function(c){if(c){if(a.type(c)=="string"){c=JSON.parse(c.trim())}if(c.status){b.$el.trigger("loadTemplateSuccessful",[c.templates]);b.allowLoadMore=c.load_more}}})},renderController:function(){return'<a href="#folder-page" class="ui-tabs-anchor" role="presentation" tabindex="-1" id="ui-id-11"><i class="ic ac-icon-section"></i>Section</a>'},render:function(){this.$el.append(this.template())},initDragTemplate:function(){var b=this;if(this.allowDragTemplate){a(".library-template-item",this.$el).draggable({iframeFix:true,helper:"clone",handle:".lti-background",start:function(c,d){a(".scroll-bar",b.$el).addClass("position-default");d.helper.css("z-index",9999)},stop:function(c,d){a(".scroll-bar",b.$el).removeClass("position-default")},connectToSortable:AWEContent.$sectionsWrapper})}},markFavouriteTemplate:function(f){f.preventDefault();var c=this,d=a(f.target).parents(".library-template-item:first"),e=JSON.parse(a("input[name=template-data]",d).val().trim()),b=d.hasClass("favourite")?0:1;a.post(AWEContent.Path.templateActionURL,{act:"favourite",tid:d.data("template-id"),favourite:b},function(g){if(g){if(a.type(g)=="string"){g=JSON.parse(g.trim())}if(g.status){if(!b){d.removeClass("favourite");e.favourite=0}else{d.addClass("favourite");e.favourite=1}a("input[name=template-data]",d).val(JSON.stringify(e))}}})},removeTemplate:function(c){c.preventDefault();var b=a(c.target).parents(".library-template-item:first");if(confirm("This template will be removed permanently. Are you sure?")){a.post(AWEContent.Path.templateActionURL,{act:"remove",tid:b.data("template-id")},function(d){if(d){if(a.type(d)=="string"){d=JSON.parse(d.trim())}if(d.status){var e=JSON.parse(a("input[name=template-data]",b).val().trim());b.remove()}else{alert(d.msg)}}})}},updateTemplateCategoryNumber:function(c){var b;if(c=="favourite"){b=a(".library-template-item.favourite",self.$el).length;a(".select-list li.select-template[data-value=favourite] span.ati-quantity").html("("+b+")")}else{b=a(".library-template-item.template-"+c,self.$el).length;a(".select-list li.select-template[data-value=template-"+c+"] span.ati-quantity").html("("+b+")")}}});AWEContent.Views.ShortCodeToolbar=AWEContent.Views.Toolbar.extend({id:"all-element",initToolbar:function(){var b=this;AWEContent.Views.Toolbar.prototype.initToolbar.call(this);a("ul.all-element",this.$el).mouseenter(function(){var d=AWEContent.contentIframe.height(),c=AWEContent.contentIframe.scrollTop();a(".awecontent-wrapper").height(d);a(window).scrollTop(c)});a("ul.all-element > li.item-element",this.$el).draggable({iframeFix:true,helper:"clone",refreshPositions:true,start:function(c,d){a(".scroll-bar",b.$el).addClass("position-default").height(a(window).height());d.helper.css("z-index",9999)},stop:function(c,d){a(".scroll-bar",b.$el).removeClass("position-default").height("")}});a(".scroll-bar",b.$el).perfectScrollbar().scroll(function(){var d=a(this),c=parseInt(a(".ps-scrollbar-y-rail",d).css("top"));a("li.item-element:not(.ui-draggable-dragging, .ui-sortable-helper)",d).draggable("option","cursorAt",{top:c})}).trigger("scroll");AWEContent.Panels.toolbarPanel.updateSortableColumn()},renderController:function(){return'<a href="#all-element"><i class="ic ac-icon-objects"></i>Objects</a>'},render:function(){this.$el.append('<div class="obj-adjust scroll-bar"><ul class="all-element"></ul></div>')}});a(document).ready(function(){AWEContent.Toolbars.template=new AWEContent.Views.TemplateToolbar();AWEContent.Toolbars.shortcodes=new AWEContent.Views.ShortCodeToolbar()})})(jQuery);