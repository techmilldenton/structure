(function(a){AWEContent.Models.Image=Backbone.RelationalModel.extend({defaults:{fid:-1,srcThumbStyle:"",srcImageStyle:"",linkImage:"",captionImage:"",targetImage:1,enableCaption:0,enableLightBox:1,captionPosition:"top",boxModelSettings:{}},relations:[{type:Backbone.HasOne,key:"boxModelSettings",relatedModel:AWEContent.Models.BoxModelSettings}],createView:function(){this.view=new AWEContent.Views.Image({model:this})},getView:function(){return this.view},clone:function(){var b={};a.each(this.toJSON(),function(c,d){b[c]=d});b.boxModelSettings=new AWEContent.Models.BoxModelSettings(b.boxModelSettings);return new AWEContent.Models.Image(b)}});AWEContent.Views.Image=Backbone.View.extend({tagName:"li",className:"md-item-image",events:{"click .awe-box-btn":"changeContent","click .edit-link":"editLink","click .edit-caption":"editCaption","click .remove-image":"destroyImage"},template:_.template('<div class="awe-image-item">                <a class="mgf-md-popup <%= enableLightBox %>" target="<%= targetImage %>" href="<%= extendImage %>">                    <div class="awe-image-content">                        <% if (captionPos == "over" || captionPos == "top") { %>                        <div class="awe-image-caption"><%= captionImage %></div>                        <% } %>                        <div class="awe-image-container"><img src="<%= srcImage %>" alt=""></div>                        <% if (captionPos == "bottom") { %>                        <div class="awe-image-caption"><%= captionImage %></div>                        <% } %>                    </div>                </a>                <div class="awe-image-control">                    <ul>                        <li class="edit-link"<% if (enableLightBox) { %> style="display: none;" <% } %>>                            <i class="ic ac-icon-link"></i>                            <div class="awe-control-box">                                <div class="awe-box-header">Image link</div>                                <div class="awe-box-content">                                    <div class="awe-box-item">                                        <textarea></textarea>                                    </div>                                    <div class="awe-box-item">                                        <input type="checkbox" name="target" id="ckb-target" class="ckb-target">                                        <label for="ckb-target" class="label-checkbox">Open new window</label>                                    </div>                                </div>                                <div class="awe-box-footer">                                    <a href="#" class="awe-box-btn js-ok">Save</a>                                    <a href="#" class="awe-box-btn js-cancel">Cancel</a>                                </div>                            </div>                        </li>                        <li class="edit-caption"<% if (!enableCaption) { %> style="display: none;" <% } %>>                            <i class="ic ac-icon-caption"></i>                            <div class="awe-control-box">                                <div class="awe-box-header">Image caption</div>                                 <div class="awe-box-content">                                    <div class="awe-box-item">                                        <textarea></textarea>                                    </div>                                </div>                                <div class="awe-box-footer">                                    <a href="#" class="awe-box-btn js-ok">Save</a>                                    <a href="#" class="awe-box-btn js-cancel">Cancel</a>                                </div>                            </div>                        </li>                        <li class="remove-image"><i class="ic ac-icon-trash"></i></li>                    </ul>                </div>            </div>'),initialize:function(){this.listenTo(this.model,"change",this.changeSettings);this.listenTo(this.model.get("boxModelSettings"),"change",this.changeSettings);this.render();this.$el.delegate(".awe-control-box","click",function(b){b.stopPropagation()})},render:function(){var j=this,c=j.model.toJSON(),e=c.srcThumbStyle,d=c.srcImageStyle,f=c.linkImage?c.linkImage:"javascript:void(0)",g=c.captionImage,h=c.targetImage?"_blank":"_self",i=c.enableLightBox?"open-lightbox":"",b=c.enableLightBox?d:f;if(c.linkImage==""){h="_self"}j.$el.append(j.template({srcImage:e,captionImage:g,enableLightBox:i,enableCaption:c.enableCaption,targetImage:h,extendImage:b,captionPos:c.captionPosition}));j.$img=a("img",j.el);j.$mgfPopup=a(".mgf-md-popup",j.el);if(c.captionPosition=="over"){j.$el.addClass("position-over")}a(".awe-image-item",j.el).renderItemDefaultBoxModel(c.boxModelSettings);setTimeout(function(){j.resizeImage()},50);return j.$el},resizeImage:function(){this.$img.css({width:"",height:""});var d=this.$img.width(),b=this.$img.height(),c=0.75;if((b/d)>c){d="100%";b="auto"}else{d="auto";b="100%"}this.$img.css({width:d,height:b})},changeSettings:function(c){var b=this,d=b.model.toJSON(),e=a(".mgf-md-popup",b.el),g=a(".awe-image-caption",b.el),f=a(".awe-image-content",b.el);a.each(c.changedAttributes(),function(h,i){switch(h){case"srcThumbStyle":b.$img.attr("src",i);b.$img.load(function(){b.resizeImage()});break;case"srcImageStyle":if(d.enableLightBox){b.$mgfPopup.attr("href",i)}break;case"linkImage":if(!d.enableLightBox){b.$mgfPopup.attr("href",i)}break;case"captionImage":g.html(i);b.setMaxHeight(b.$el.index());break;case"targetImage":var j=i?"_blank":"_self";e.attr("target",j);break;case"enableLightBox":if(i){a(".edit-link",b.el).hide();b.$mgfPopup.addClass("open-lightbox").attr("href",d.srcImageStyle)}else{a(".edit-link",b.el).show();var k=d.linkImage?d.linkImage:"javascript:void(0)";b.$mgfPopup.removeClass("open-lightbox").attr("href",k).attr("target","_self")}break;case"captionPosition":b.$el.removeClass("position-over");switch(i){case"top":f.prepend(g);break;case"bottom":f.append(g);break;case"over":b.$el.addClass("position-over");break}break;default:a(".awe-image-item",b.el).renderChangeSettingBoxModel(h,i,c)}})},changeContent:function(f){f.preventDefault();f.stopPropagation();var c=this,b=a(f.target),g=b.closest("li.active"),e=a("textarea",g).val();g.removeClass("active");if(b.hasClass("js-ok")){if(g.hasClass("edit-link")){var d=a(".ckb-target",g).prop("checked");c.model.set("linkImage",e);c.model.set("targetImage",d?1:0)}else{if(g.hasClass("edit-caption")){c.model.set("captionImage",e)}}}},editLink:function(d){var c=this,f=c.model.get("linkImage"),b=a(d.target).hasClass("edit-link")?a(d.target):a(d.target).closest(".edit-link"),e=a("textarea",b);b.siblings("li").removeClass("active");b.toggleClass("active");e.val(f).parent().css("z-index",999)},editCaption:function(d){var c=this,f=c.model.get("captionImage"),b=a(d.target).hasClass("edit-caption")?a(d.target):a(d.target).closest(".edit-caption"),e=a("textarea",b);b.siblings("li").removeClass("active");b.toggleClass("active");e.val(f).parent().css("z-index",999)},destroyImage:function(){this.model.destroy();this.$el.remove()},setMaxHeight:function(d){if(d!=undefined){var c=this.model.get("columns"),f=Math.floor(d/c-1),b=a("li.md-item-image",this.$el.parent()).slice(f,c),e=0;a(".awe-image-caption",b).css("height","");b.each(function(){var g=a(".awe-image-caption",this).height();if(g>e){e=g}});if(e>0){a(".awe-image-caption",b).height(e)}}}});AWEContent.Collections.ListImage=Backbone.Collection.extend({model:AWEContent.Models.Image});AWEContent.Views.ListImage=Backbone.View.extend({tagName:"ul",className:"list-gallery clearfix",events:{},initialize:function(){this.listenTo(this.collection,"add",this.addImage);this.listenTo(this.collection,"destroy",this.removeImage);this.render()},render:function(){var b=this;b.collection.each(function(d,c){d.createView();b.$el.append(d.getView().$el)})},addImage:function(b,c){b.createView();this.$el.append(b.getView().$el)}});AWEContent.Models.GalleryItem=AWEContent.Models.Item.extend({defaults:{machine_name:"gallery",images:[],columns:5,customColumnsResponsive:0,smallDesktopColumns:4,tabletColumns:3,mobileColumns:1,styleImage:"none",enableLightBox:1,enableThumbnail:1,styleThumb:"none",enableCaption:1,captionColor:"",captionPosition:"over",captionOnHover:0,imageBgOverlay:"",captionOnLightBox:1,boxModelSettings:{},imageBoxModelSettings:{},customID:"",customClass:"",customEnableAttributes:0,customDataAttributes:"[]",customActionAttributes:'{"newAction": "", "newAttrName": "", "newAttrValue": ""}',customEnableAnimations:1,customDataAnimations:'{"type" : "none"}',lgResponsive:true,xsResponsive:true,mediumResponsive:true,smResponsive:true,itemsThumb:5},relations:[{type:Backbone.HasOne,key:"boxModelSettings",relatedModel:AWEContent.Models.BoxModelSettings},{type:Backbone.HasOne,key:"imageBoxModelSettings",relatedModel:AWEContent.Models.BoxModelSettings},{type:Backbone.HasMany,key:"images",relatedModel:AWEContent.Models.Image,relatedCollection:AWEContent.Collections.ListImage}],createView:function(){this.view=new AWEContent.Views.GalleryItem({model:this})},clone:function(){var c={},b=new AWEContent.Collections.ListImage();this.get("images").each(function(d,e){b.add(d.clone())});a.each(this.toJSON(),function(d,e){if(d!="images"){c[d]=e}});c.images=b;c.boxModelSettings=new AWEContent.Models.BoxModelSettings(c.boxModelSettings);c.imageBoxModelSettings=new AWEContent.Models.BoxModelSettings(c.imageBoxModelSettings);return new AWEContent.Models.GalleryItem(c)}});AWEContent.Views.GalleryItem=AWEContent.Views.Item.extend({refreshGidImage:function(){if(AWEContent.Panels.gallery.isOpenned){AWEContent.Panels.gallery.setPanelElementsValue(true)}},initialize:function(){AWEContent.Views.Item.prototype.initialize.call(this);this.listenTo(this.model.get("boxModelSettings"),"change",this.applySettingsChanged);this.listenTo(this.model.get("imageBoxModelSettings"),"change",this.applySettingsChangedImageStyle);this.listenTo(this.model.get("images"),"remove",this.refreshGidImage);this.listenTo(this.model.get("images"),"add",this.addImage)},applySettingsChangedImageStyle:function(c){var b=this;a.each(c.changedAttributes(),function(d,e){b.model.get("images").each(function(f,g){f.get("boxModelSettings").set(d,e)})})},renderItemContent:function(){var g=this,h=g.model.toJSON(),c=g.model.get("images"),b=a('<div class="awe-item awe-gallery"></div>'),f=new AWEContent.Views.ListImage({collection:c});AWEContent.Library.addLibrary("magnific",function(){d()});b.append(f.$el);b.addClass("image-col-"+h.columns);if(h.customColumnsResponsive){b.addClass("image-col-md-"+h.smallDesktopColumns+" image-col-sm-"+h.tabletColumns+" image-col-xs-"+h.mobileColumns)}c.each(function(j){h.enableLightBox?j.set("enableLightBox",1):j.set("enableLightBox",0);(h.enableCaption||(h.enableLightBox&&h.captionOnLightBox))?j.set("enableCaption",1):j.set("enableCaption",0);j.set("captionPosition",h.captionPosition)});b.attr("data-enable-thumb",h.enableThumbnail?true:false);b.attr("data-caption-on-lightbox",h.captionOnLightBox?true:false);if(!h.enableCaption){b.addClass("disable-caption")}if(h.captionPosition=="over"){a("li .awe-image-content",b).prepend('<div class="awe-image-overlay"></div>');a("li .awe-image-content > .awe-image-overlay",b).css("background-color",h.imageBgOverlay);if(h.captionOnHover){b.addClass("caption-hover")}}b.attr("id",h.customID).addClass(h.customClass).renderItemDefaultBoxModel(h.boxModelSettings);b.renderItemDefaultAttributes(h.customEnableAttributes,h.customDataAttributes);if(h.customEnableAnimations){b.processAnimations(h.customDataAnimations)}g.$el.defaultResponsive(h);a(".awe-image-caption",b).css("color",h.captionColor);var i=AWEContent.jqIframe;g.isOpenThumb=false;var e=setInterval(function(){if(AWEContent.contentIframe.find(".md-item-image").length>0){clearInterval(e);var j=0,k=0;AWEContent.jqIframe(".list-gallery").sortable({items:" > li",revert:true,forcePlaceholderSize:true,start:function(l,m){a(".js-edit-item",g.$el).trigger("click");j=m.item.index()},stop:function(m,n){k=n.item.index();if(k!=j){var l=g.model.get("images").remove(g.model.get("images").at(j),{silent:true});g.model.get("images").add(l,{at:k,silent:true});AWEContent.Panels.gallery.setPanelElementsValue(true);g.refreshGidImage();g.setItemHeight()}}});setTimeout(function(){g.resizeItem();g.setItemHeight()},50)}},50);b.aweDragUpload({multiUpload:true,uploadSuccessCallback:function(k,p){if(k.status&&k.file){var j=g.model.get("images"),l=g.model.get("styleImage"),o=g.model.get("styleThumb"),m=l+","+o,n=k.file;a.post(AWEContent.Path.imageStyleURL,{fids:""+n.fid,styles:m},function(r){if(a.type(r)=="string"){r=JSON.parse(r.trim())}if(g.model.get("createFromDefault")==true){g.model.get("images").at(0).set({fid:n.fid,srcThumbStyle:r[n.fid][g.model.get("styleThumb")],srcImageStyle:r[n.fid][g.model.get("styleImage")],enableCaption:g.model.get("enableCaption")||(g.model.get("enableLightBox")&&g.model.get("captionOnLightBox"))});g.model.set("createFromDefault",false)}else{var q=new AWEContent.Models.Image({fid:n.fid,srcThumbStyle:r[n.fid][g.model.get("styleThumb")],srcImageStyle:r[n.fid][g.model.get("styleImage")],captionPosition:g.model.get("captionPosition"),enableLightBox:g.model.get("enableLightBox"),enableCaption:g.model.get("enableCaption")||(g.model.get("enableLightBox")&&g.model.get("captionOnLightBox")),boxModelSettings:new AWEContent.Models.BoxModelSettings(g.model.get("imageBoxModelSettings").toJSON())});j.add(q);g.refreshGidImage()}})}},uploadFinishedCallback:function(){g.resizeItem()}});function d(){AWEContent.jqIframe(b).magnificPopup({delegate:".open-lightbox",type:"image",removalDelay:300,prependTo:".awe-page-wrapper",mainClass:"mfp-fade",callbacks:{open:function(s,m){var r=i(".mfp-container"),j=i(".mfp-content",r),o=i('<div class="mdf-list-thumb"><div class="thumb-content"><div class="thumb-control"></div></div></div>'),l=i(".thumb-content",o),k=i(".thumb-control",o),p=i(".mgf-md-popup img",g.el),n=g.model.get("itemsThumb"),q=this.ev.attr("data-enable-thumb");k.append('<i class="ic ac-icon-arrow-left gallery-prev"></i><i class="ic ac-icon-arrow-right gallery-next"></i><input type="hidden" class="gallery-trigger"/>');if(!r.next(".mdf-list-thumb").length&&q=="true"){i.each(p,function(v,u){var t=a('<img src=""/>').attr("src",a(u).attr("src"));i(".thumb-content",o).append(t)});j.after(o);l.click(function(t){t.stopPropagation()});l.change(function(x,y){if(y!=undefined&&typeof y.index=="number"){var u=y.index;i("img",l).removeClass("img-show");i("img",l).eq(u).addClass("active");for(var w=0;w<n;w++){var t=u+w;i("img",l).eq(t).addClass("img-show")}var v=i("img.img-show",l).length;if(v<n){for(w=0;w<n-v;w++){t=u-1-w;i("img",l).eq(t).addClass("img-show")}}}});i("img",l).click(function(){var t=i(this).index()-1;i(this).addClass("active");i(this).siblings("img").removeClass("active");i.magnificPopup.instance.goTo(t)});i(".gallery-trigger",r).change(function(v,w){v.stopPropagation();if(w!=undefined&&typeof w.index=="number"){var u=w.index,t=i("img",l).eq(u);t.addClass("active");t.siblings("img").removeClass("active");if(!t.hasClass("img-show")){l.trigger("change",{index:u})}}});i(".gallery-next",k).click(function(){if(i(".img-show:last",l).index()==i("img",l).length){i(".gallery-trigger",r).trigger("change",{index:0,isNav:true});i("img.active",l).removeClass("active")}else{var w=i("img.img-show:last",l).index();i("img.img-show",l).removeClass("img-show");for(var x=0;x<n;x++){var t=w+x;i("img",l).eq(t).addClass("img-show")}if(i(".img-show",l).length<n){var y=i(".img-show",l).length,u=i(".img-show:first",l).index()-1;for(x=0;x<(n-y);x++){var v=u-x-1;i("img",l).eq(v).addClass("img-show")}}}});i(".gallery-prev",k).click(function(){if(i(".img-show:first",l).index()==1){var w=a("img",l).length-n;i(".gallery-trigger",r).trigger("change",{index:w,isNav:true});i("img.active",l).removeClass("active")}else{var z=i("img.img-show:first",l).index()-2;i("img.img-show",l).removeClass("img-show");for(var x=0;x<n;x++){var u=z-x;if(u>=0||u<=i("img",l)-1){i("img",l).eq(u).addClass("img-show")}}if(i(".img-show",l).length<n){var y=i(".img-show",l).length,t=i(".img-show:last",l).index()-1;for(x=0;x<(n-y);x++){var v=t+x+1;i("img",l).eq(v).addClass("img-show")}}}})}},change:function(j){setTimeout(function(){var l=i(".mfp-container"),k=i(".thumb-content",l);if(!g.isOpenThumb){g.isOpenThumb=true;k.trigger("change",{index:j.index})}i(".gallery-trigger",l).trigger("change",{index:j.index})},50)},markupParse:function(n,l,o){var k=a(".awe-image-caption",o.el).html(),j=a(".awe-image-caption",o.el).css("color"),m=this.ev.attr("data-caption-on-lightbox");if(m&&m=="true"){l.description=a("<div />").html(k).css("color",j)}else{l.description=""}},close:function(){g.isOpenThumb=false}},gallery:{enabled:true},image:{headerFit:true,captionFit:true,preserveHeaderAndCaptionWidth:false,markup:'<div class="mfp-figure">                                <div class="mfp-img"></div>                                <div class="mfp-description"></div>                                <div class="mfp-counter"></div>                            </div>'}})}return b},setItemHeight:function(){var c=a("li.md-item-image",this.$el),d=this.model.get("columns"),g=0,f=c.length;a(".awe-image-caption",c).css("height","");do{var b=c.slice(g,d),e=0;g=g+d;b.each(function(){var h=a(".awe-image-caption",this).height();if(h>e){e=h}});a(".awe-image-caption",b).height(e)}while(g<f-1)},applySettingsChanged:function(d){var c=this,e=c.model.toJSON(),g=c.model.get("images"),b=a(".awe-gallery",c.el),f=c.$el.height();a.each(d.changedAttributes(),function(q,p){c.$el.changeResponsive(q,p);b.renderChangeSettingBoxModel(q,p,d);switch(q){case"columns":var r="image-col-"+c.model.previousAttributes().columns,k="image-col-"+p;b.removeClass(r).addClass(k);c.resizeItem();break;case"customColumnsResponsive":var s="image-col-md-"+e.smallDesktopColumns,u="image-col-sm-"+e.tabletColumns,i="image-col-xs-"+e.mobileColumns;if(p){b.addClass(s+" "+u+" "+i)}else{b.removeClass(s+" "+u+" "+i)}break;case"smallDesktopColumns":var o="image-col-md-"+c.model.previousAttributes()[q];b.removeClass(o).addClass("image-col-md-"+p);break;case"tabletColumns":var o="image-col-sm-"+c.model.previousAttributes()[q];b.removeClass(o).addClass("image-col-sm-"+p);break;case"mobileColumns":var o="image-col-xs-"+c.model.previousAttributes()[q];b.removeClass(o).addClass("image-col-xs-"+p);break;case"styleImage":case"styleThumb":var m=e.styleImage,n=e.styleThumb,t=m+","+n,l=[];a.each(g.toJSON(),function(){l.push(this.fid)});if(l.length){a.post(AWEContent.Path.imageStyleURL,{fids:l.join(","),styles:t},function(w){if(a.type(w)=="string"){w=JSON.parse(w.trim())}g.each(function(x){if(w[x.get("fid")]){x.set({srcThumbStyle:w[x.get("fid")][e.styleThumb],srcImageStyle:w[x.get("fid")][e.styleImage]})}})})}break;case"enableLightBox":g.each(function(w){w.set("enableLightBox",p)});if((p&&e.captionOnLightBox)||e.enableCaption){a(".edit-caption",b).show()}else{a(".edit-caption",b).hide()}break;case"enableThumbnail":b.attr("data-enable-thumb",p?true:false);break;case"enableCaption":if(p){b.removeClass("disable-caption");a(".edit-caption",b).show()}else{b.addClass("disable-caption");if(!e.enableLightBox||!e.captionOnLightBox){a(".edit-caption",b).hide()}}break;case"captionPosition":g.each(function(w){w.set("captionPosition",p)});if(p!="over"){b.removeClass("caption-hover");a("li .awe-image-content > .awe-image-overlay",b).remove()}else{if(e.captionOnHover){b.addClass("caption-hover")}a("li .awe-image-content",b).prepend('<div class="awe-image-overlay"></div>');a("li .awe-image-content > .awe-image-overlay",b).css("background-color",e.imageBgOverlay);a("li .awe-image-content > .awe-image-overlay",b).click(function(){a(".mgf-md-popup",a(this).parent()).trigger("click")})}break;case"captionColor":a(".awe-image-caption",b).css("color",p);break;case"captionOnHover":if(p&&e.captionPosition=="over"){b.addClass("caption-hover")}else{b.removeClass("caption-hover")}break;case"imageBgOverlay":a("li .awe-image-content > .awe-image-overlay",b).css("background-color",p);break;case"captionOnLightBox":b.attr("data-caption-on-lightbox",p?true:false);if(!p&&!e.enableCaption){a(".edit-caption",b).hide()}else{a(".edit-caption",b).show()}break;case"customID":b.attr("id",p);break;case"customClass":var h=c.model.previousAttributes().customClass;b.removeClass(h).addClass(p);break;case"customEnableAttributes":b.renderChangeSettingsAttributes(q,p,e.customDataAttributes);break;case"customActionAttributes":b.renderChangeSettingsAttributes(q,p);break;case"customEnableAnimations":var j,v;if(p){j=e.customDataAnimations;v=null;b.processAnimations(j)}else{j=null;v=e.customDataAnimations;b.processAnimations(j,v)}break;case"customDataAnimations":var j=e.customDataAnimations,v=c.model.previousAttributes().customDataAnimations;b.processAnimations(j,v);break}});setTimeout(function(){c.checkChangeHeight(f)},100)},addImage:function(){var c=this,b=a(".awe-gallery",this.el);if(this.model.get("captionPosition")=="over"){a(".md-item-image",b).each(function(){if(a(".awe-image-overlay",a(this)).length==0){a(".awe-image-content",a(this)).prepend('<div class="awe-image-overlay"></div>');a(".awe-image-overlay",a(this)).css("background-color",c.model.get("imageBgOverlay"))}})}}});AWEContent.Views.GalleryItemController=AWEContent.Views.ItemController.extend({machineName:"gallery",controllerHtml:function(){return'<div class="title-icon">Gallery</div><i class="ic ac-icon-gallery"></i>'},createItemModel:function(g){var h,b,f;if(g!=undefined){h=new AWEContent.Models.BoxModelSettings(g.boxModelSettings);b=new AWEContent.Collections.ListImage(g.images);g.boxModelSettings=h;g.images=b;g.createFromDefault=false;return new AWEContent.Models.GalleryItem(g)}else{h=new AWEContent.Models.BoxModelSettings();f=new AWEContent.Models.BoxModelSettings();var e=new AWEContent.Collections.ListImage(),c=new AWEContent.Models.GalleryItem({boxModelSettings:h,images:e,imageBoxModelSettings:f,createFromDefault:true}),d=new AWEContent.Models.Image({srcImageStyle:AWEContent.Path.defaultImage,srcThumbStyle:AWEContent.Path.defaultImage,enableLightBox:c.get("enableLightBox"),enableCaption:(c.get("enableCaption")||(c.get("enableLightBox")&&c.get("captionOnLightBox")))});c.get("images").add(d);return c}}});AWEContent.Views.GalleryPanel=AWEContent.Views.ItemPanel.extend({tagName:"div",className:"awe-obj-panel gallery-panel",panelName:"gallery",initPanel:function(){AWEContent.Views.ItemPanel.prototype.initPanel.call(this);var b=this;b.$el.mousedown(function(){if(AWEContent.jqIframe(".mfp-close-btn-in").length){AWEContent.jqIframe(".mfp-close-btn-in").trigger("click")}});a("#gallery-select-image .control-gallery input[name=selected_media]",b.el).change(function(){var c=a.parseJSON(a(this).val().trim()),f='<div class="book-lib"><i class="ic ac-icon-done"></i><img src="" alt="book"><input type="hidden" name="selected_media"/></div>';if(typeof c=="object"){var i=a("#gallery-select-image .library",b.el),d=b.editingModel.get("styleImage"),e=b.editingModel.get("styleThumb"),g=d+","+e,h=[];a.each(c,function(){h.push(this.fid)});if(AWEContent.Path.imageStyleURL!=""){a.post(AWEContent.Path.imageStyleURL,{fids:h.join(","),styles:g},function(j){if(a.type(j)=="string"){try{j=JSON.parse(j)}catch(k){}}if(typeof(j)=="object"){a.each(c,function(){var n=this;if(!b.editingModel.get("images").length&&b.editingModel.get("createFromDefault")){b.editingModel.set("createFromDefault",false)}if(b.editingModel.get("createFromDefault")){b.editingModel.set("createFromDefault",false);b.editingModel.get("images").at(0).set({fid:n.fid,srcThumbStyle:j[n.fid][b.editingModel.get("styleThumb")],srcImageStyle:j[n.fid][b.editingModel.get("styleImage")]});a("img",i).eq(0).attr("src",n.file_url)}else{var l=new AWEContent.Models.Image({fid:n.fid,srcThumbStyle:j[n.fid][b.editingModel.get("styleThumb")],srcImageStyle:j[n.fid][b.editingModel.get("styleImage")],captionPosition:b.editingModel.get("captionPosition"),enableLightBox:b.editingModel.get("enableLightBox"),enableCaption:(b.editingModel.get("enableLightBox")&&b.editingModel.get("captionOnLightBox"))||b.editingModel.get("enableCaption"),boxModelSettings:new AWEContent.Models.BoxModelSettings(b.editingModel.get("imageBoxModelSettings").toJSON())}),m=a(f);a("img",m).attr("src",n.file_url);i.append(m);b.editingModel.get("images").add(l)}})}})}else{a.each(c,function(){var l=this;if(!b.editingModel.get("images").length&&b.editingModel.get("createFromDefault")){b.editingModel.set("createFromDefault",false)}if(b.editingModel.get("createFromDefault")){b.editingModel.set("createFromDefault",false);b.editingModel.get("images").at(0).set({srcThumbStyle:l.file_url,srcImageStyle:l.file_url,fid:l.fid});a("img",i).eq(0).attr("src",l.file_url)}else{var j=new AWEContent.Models.Image({fid:l.fid,srcThumbStyle:l.file_url,srcImageStyle:l.file_url,enableCaption:(b.editingModel.get("enableLightBox")&&b.editingModel.get("captionOnLightBox"))||b.editingModel.get("enableCaption"),enableLightBox:b.editingModel.get("enableLightBox"),boxModelSettings:new AWEContent.Models.BoxModelSettings(b.editingModel.get("imageBoxModelSettings").toJSON())}),k=a(f);a("img",k).attr("src",l.file_url);i.append(k);b.editingModel.get("images").add(j);j.set("captionPosition",b.editingModel.get("captionPosition"));j.set("enableLightBox",b.editingModel.get("enableLightBox"))}})}}});a("#gallery-select-image",b.el).delegate(".book-lib input[name=selected_media]","change",function(){var f=a(this).closest(".book-lib"),e=f.index(),d=b.editingModel.get("images").at(e),c=b.editingModel.get("styleImage"),g=b.editingModel.get("styleThumb"),h=c+","+g,i=a.parseJSON(a(this).val().trim());if(i){if(AWEContent.Path.imageStyleURL!=""){a.post(AWEContent.Path.imageStyleURL,{fids:""+i.fid,styles:h},function(j){d.set({fid:i.fid,srcThumbStyle:j[i.fid][b.editingModel.get("styleThumb")],srcImageStyle:j[i.fid][b.editingModel.get("styleImage")]})})}else{d.set({fid:i.fid,srcThumbStyle:i.file_url,srcImageStyle:i.file_url})}a("img",f).attr("src",i.file_url);if(b.editingModel.get("createFromDefault")){b.editingModel.set("createFromDefault",false)}}});a("#gallery-column",this.el).change(function(d,c){b.editingModel.set("columns",c.value)});if(AWEContent.Path.imageStyleURL!=""){a("#gallery-style-image",this.el).change(function(d,c){b.editingModel.set("styleImage",c.value)});a("#gallery-style-thumbnail",this.el).change(function(d,c){b.editingModel.set("styleThumb",c.value)})}a("#gallery-custom-column-responsive input[name=toggle_value]",this.el).change(function(d,c){var e=parseInt(a(this).val());if(!c){b.editingModel.set("customColumnsResponsive",e)}a("#gallery-columns-desktop-small, #gallery-columns-tablet, #gallery-columns-mobile",b.el).hide();if(e){a("#gallery-columns-desktop-small, #gallery-columns-tablet, #gallery-columns-mobile",b.el).show()}});a("#gallery-columns-desktop-small",b.$el).change(function(d,c){b.editingModel.set("smallDesktopColumns",c.value)});a("#gallery-columns-tablet",b.$el).change(function(d,c){b.editingModel.set("tabletColumns",c.value)});a("#gallery-columns-mobile",b.$el).change(function(d,c){b.editingModel.set("mobileColumns",c.value)});a("#gallery-enable-lightbox input[name=toggle_value]",this.el).change(function(d,c){var e=parseInt(a(this).val());if(!c){b.editingModel.set("enableLightBox",e)}a("#gallery-enable-thumbnail, #gallery-number-thumbnail, #gallery-on-lightbox, #gallery-style-image, .lightbox-style-title",b.el).hide();if(e){a("#gallery-enable-thumbnail, #gallery-style-image, #gallery-on-lightbox, .lightbox-style-title",b.el).show();a("#gallery-enable-thumbnail input[name=toggle_value]",b.el).trigger("change",{isPanel:true})}a("#gallery-caption-color",b.el).hide();if((e&&b.editingModel.get("captionOnLightBox"))||b.editingModel.get("enableCaption")){a("#gallery-caption-color",b.el).show()}});a("#gallery-enable-thumbnail input[name=toggle_value]",this.el).change(function(d,c){if(parseInt(a(this).val())){a("#gallery-number-thumbnail",b.el).show()}else{a("#gallery-number-thumbnail",b.el).hide()}if(!c){b.editingModel.set("enableThumbnail",parseInt(a(this).val()))}});a("#gallery-number-thumbnail",this.el).change(function(d,c){b.editingModel.set("itemsThumb",c.value)});a("#gallery-enable-caption input[name=toggle_value]",this.el).change(function(d,c){var e=parseInt(a(this).val());if(!c){b.editingModel.set("enableCaption",e)}a("#gallery-position, #gallery-on-hover, #gallery-image-bg-overlay",b.el).hide();a("#gallery-caption-color",b.$el).show();if(e){a("#gallery-position",b.el).show();if(b.editingModel.get("captionPosition")=="over"){a("#gallery-on-hover, #gallery-image-bg-overlay",b.$el).show()}}else{if(!b.editingModel.get("enableLightBox")||!b.editingModel.get("captionOnLightBox")){a("#gallery-caption-color",b.$el).hide()}}});a("#gallery-position",this.el).change(function(d,c){b.editingModel.set("captionPosition",c.value);a("#gallery-on-hover, #gallery-image-bg-overlay").hide();if(c.value=="over"&&b.editingModel.get("enableCaption")){a("#gallery-on-hover, #gallery-image-bg-overlay").show()}});a("#gallery-caption-color",this.el).change(function(d,c){c=c?c.toRgbString():"";b.editingModel.set("captionColor",c)});a("#gallery-on-hover input[name=toggle_value]",this.el).change(function(d,c){if(!c){b.editingModel.set("captionOnHover",parseInt(a(this).val()))}});a("#gallery-image-bg-overlay",this.el).change(function(d,c){c=c?c.toRgbString():"";b.editingModel.set("imageBgOverlay",c)});a("#gallery-on-lightbox input[name=toggle_value]",this.el).change(function(d,c){var e=parseInt(a(this).val());if(!c){b.editingModel.set("captionOnLightBox",e)}a("#gallery-caption-color",b.$el).show();if(!e&&!b.editingModel.get("enableCaption")){a("#gallery-caption-color",b.$el).hide()}});a("#gallery-layout-tab",this.el).initBoxModelPanel(this,"boxModelSettings");a("#gallery-image-layout-tab",this.el).initBoxModelPanel(this,"imageBoxModelSettings");a("#text-gallery-custom-id",this.el).change(function(){b.editingModel.set("customID",a(this).val())});a("#text-gallery-custom-classes",this.el).change(function(){b.editingModel.set("customClass",a(this).val())});a("#gallery-custom-attributes",this.el).initAttributesPanel(b);a("#gallery-animations",this.el).change(function(c,d){b.editingModel.set("customEnableAnimations",d.enabled);if(d){b.editingModel.set("customDataAnimations",d.animations)}})},setPanelElementsValue:function(e){var b=this,d=this.editingModel.toJSON(),c='<div class="book-lib"><i class="ic ac-icon-done"></i><img src="" alt="book"><input type="hidden" name="selected_media"/></div>',f=a("#gallery-select-image .library",b.el);f.empty();a.each(d.images,function(g,h){var i=a(c);a("img",i).attr("src",h.srcThumbStyle);f.append(i)});if(!e){a("#gallery-column",this.el).aweSlider("value",d.columns);a("#gallery-custom-column-responsive input[name=toggle_value]",b.el).val(d.customColumnsResponsive).trigger("change",true);a("#gallery-columns-desktop-small",this.el).aweSlider("value",d.smallDesktopColumns);a("#gallery-columns-tablet",this.el).aweSlider("value",d.tabletColumns);a("#gallery-columns-mobile",this.el).aweSlider("value",d.mobileColumns);if(AWEContent.Path.imageStyleURL!=""){a("#gallery-style-image",b.el).aweSelect("value",d.styleImage);a("#gallery-style-thumbnail",b.el).aweSelect("value",d.styleThumb)}else{a("#gallery-style-image, #gallery-style-thumbnail",b.el).hide()}a("#gallery-enable-thumbnail input[name=toggle_value]",b.el).val(d.enableThumbnail).trigger("change",true);a("#gallery-enable-lightbox input[name=toggle_value]",b.el).val(d.enableLightBox).trigger("change",true);a("#gallery-enable-caption input[name=toggle_value]",b.el).val(d.enableCaption).trigger("change",true);a("#gallery-position",b.el).aweSelect("value",d.captionPosition);a("#gallery-caption-color",b.el).aweColorPicker("value",d.captionColor);a("#gallery-on-hover input[name=toggle_value]",b.el).val(d.captionOnHover).trigger("change",true);a("#gallery-image-bg-overlay",b.el).aweColorPicker("value",d.imageBgOverlay);a("#gallery-on-lightbox input[name=toggle_value]",b.el).val(d.captionOnLightBox).trigger("change",true);a("#gallery-layout-tab",b.el).initBoxModel(d.boxModelSettings);a("#gallery-image-layout-tab",b.el).initBoxModel(d.imageBoxModelSettings);a("#text-gallery-custom-id",b.el).val(d.customID);a("#text-gallery-custom-classes",b.el).val(d.customClass);a("#gallery-custom-attributes",b.el).initAttributes(d.customEnableAttributes,d.customDataAttributes);a("#gallery-animations",b.el).aweAnimation("value",{enabled:d.customEnableAnimations,animations:d.customDataAnimations,previewEl:b.editingModel.view.$el})}},buildPanel:function(){return{title:{type:"markup",markup:'<div class="awe-title"><h2>Gallery</h2></div>'},custom_style:{type:"section",select_image:{type:"gallery",title:"Add Images",columns:4},column:{type:"slider",title:"Column",values:[1,2,3,4,5,6,7,8,9,10,11,12],default_value:4,allow_type:true},custom_column_responsive:{type:"toggle",title:"Custom Responsive",default_value:0},columns_desktop_small:{type:"slider",title:"Desktop Small",values:[1,2,3,4,5,6],default_value:4,allow_type:true},columns_tablet:{type:"slider",title:"Tablet",values:[1,2,3,4,5,6],default_value:4,allow_type:true},columns_mobile:{type:"slider",title:"Mobile",values:[1,2,3,4,5,6],default_value:4,allow_type:true},style_thumbnail:{title:"Thumbnail Image Style",type:"image_style_list",default_value:"image-style",attributes:{"class":["long-title"]}},enable_lightbox:{type:"toggle",title:"Enable Lightbox",default_value:0},style_image:{title:"LightBox Image Style",type:"image_style_list",default_value:"image-style",attributes:{"class":["long-title"]}}},custom_caption:{type:"section",enable_caption:{type:"toggle",title:"Caption",default_value:0},caption_color:{type:"colorpicker",title:"Caption Text Color",options:{preferredFormat:"rgb",AlphaVerticle:true,showAlpha:true,allowEmpty:true,showInput:true}},position:{type:"select",title:"Position",options:{top:"Top",bottom:"Bottom",over:"Over"},default_value:"top"},on_hover:{type:"toggle",title:"Display on hover",default_value:0},image_bg_overlay:{type:"colorpicker",title:"ImageBgOverlay",options:{preferredFormat:"rgb",AlphaVerticle:true,showAlpha:true,allowEmpty:true,showInput:true}},on_lightbox:{type:"toggle",title:"Caption on lightbox",default_value:0}},image_title:{type:"markup",markup:'<div class="awe-title"><h4>Image Settings</h4></div>'},image_box_settings:{type:"section",image_layout_tab:{type:"tabs",tabs:[{tab_title:"Border",contents:{image_border:{type:"box_border",min_value:0,max_value:100,default_value:0}}},{tab_title:"Radius",contents:{image_boder_radius:{type:"box_model",model_type:"border_radius",min_value:0,max_value:100,allow_type:true}}},{tab_title:"Padding",contents:{image_padding:{type:"box_model",model_type:"padding",allow_type:true,min_value:0,max_value:100}}},{tab_title:"Margin",contents:{image_margin:{type:"box_model",model_type:"margin",allow_type:true,min_value:0,max_value:100}}}]}},box_settings:{type:"section",layout_tab:{type:"tabs",tabs:[{tab_title:"Border",contents:{header_border:{type:"box_border",min_value:0,max_value:100,default_value:0}}},{tab_title:"Radius",contents:{header_boder_radius:{type:"box_model",model_type:"border_radius",min_value:0,max_value:100,allow_type:true}}},{tab_title:"Padding",contents:{header_padding:{type:"box_model",model_type:"padding",allow_type:true,min_value:0,max_value:100}}},{tab_title:"Margin",contents:{header_margin:{type:"box_model",model_type:"margin",allow_type:true,min_value:0,max_value:100}}}]}},definitions:{type:"section",custom_id:{type:"text_field",title:"ID",default_value:""},custom_classes:{type:"text_field",title:"Class",default_value:""},custom_attributes:{type:"custom_attributes"},animations:{type:"animations"}}}}});a(document).ready(function(){AWEContent.Controllers.gallery=new AWEContent.Views.GalleryItemController();AWEContent.Panels.gallery=new AWEContent.Views.GalleryPanel()})})(jQuery);