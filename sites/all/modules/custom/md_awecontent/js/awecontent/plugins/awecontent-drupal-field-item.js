(function(a){AWEContent.Models.DrupalFieldItem=AWEContent.Models.Item.extend({defaults:{machine_name:"drupal_field",nodeType:"",fieldName:"",lgResponsive:true,xsResponsive:true,mediumResponsive:true,smResponsive:true},createView:function(){this.view=new AWEContent.Views.DrupalFieldItem({model:this})},removePanelView:function(){AWEContent.Toolbars.drupal.showController("field-"+this.get("fieldName"));AWEContent.Models.Item.prototype.removePanelView.call(this)}});AWEContent.Views.DrupalFieldItem=AWEContent.Views.Item.extend({renderItemContent:function(){var b=this,c=this.model.toJSON();b.$el.addClass("awe-drupal-field-item");switch(this.model.get("fieldName")){case"invisible":b.$el.prepend('<div class="awe-field-loaded">This field is used in another place on this page</div>').addClass("awe-item-unload");break;default:b.$el.prepend('<div class="awe-item-preload"></div>');a.post(AWEContent.Path.drupalElementURL,{type:this.model.get("machine_name"),nodeType:this.model.get("nodeType"),fieldName:this.model.get("fieldName"),formData:a(".awecontent-body-wrapper .node-form").serialize()},function(d){var e=d.fieldContent?d.fieldContent:'<div class="ac-field-content">'+Drupal.t("Field content")+"</div>";b.$el.prepend(e);a(".awe-item-preload",b.$el).remove();if(d.field_not_exist){b.$el.addClass("awe-item-unload")}AWEContent.Toolbars.drupal.hideController("field-"+b.model.get("fieldName"))});break}if(!c.xsResponsive){b.$el.addClass("xs-hidden")}if(!c.smResponsive){b.$el.addClass("sm-hidden")}if(!c.mediumResponsive){b.$el.addClass("md-hidden")}b.$el.defaultResponsive(c)}});AWEContent.Views.DrupalFieldController=AWEContent.Views.ItemController.extend({machineName:"drupal_field",el:"li.ac-dp-field",existingElement:true,createItemModel:function(c){if(c!=undefined){var d="field-"+c.fieldName,b=a.inArray(d,AWEContent.Toolbars.drupal.loadedElements);if(b>-1){c.fieldName="invisible"}return new AWEContent.Models.DrupalFieldItem(c)}return null},applySettingsChanged:function(c){var b=this;a.each(c.changedAttributes(),function(d,e){b.$el.changeResponsive(d,e)})}});AWEContent.Views.DrupalFieldPanel=AWEContent.Views.ItemPanel.extend({panelName:"drupal_field",el:"#drupal-field-panel",className:"awe-obj-panel drupal-field-panel",initialize:function(){this.initialized=true;AWEContent.Views.ItemPanel.prototype.initialize.call(this);var b=this;a("form.node-form #edit-actions input").click(function(){a("input[type=submit]",a(this).parents("form")).removeAttr("clicked");a(this).attr("clicked",true)});a("form.node-form").submit(function(c){if(a("#edit-actions input[clicked=true]",a(this)).attr("id")=="edit-view-field"){c.preventDefault();b.getFieldContent(a(this))}}).bind("getFieldContentSuccess",function(d,c){b.editingModel.view.$el.children(":not(.awe-custom)").remove();b.editingModel.view.$el.prepend(c.fieldContent);if(c.field_not_exit){b.$el.addClass("awe-item-unload")}AWEContent.Toolbars.drupal.hideController("field-"+b.editingModel.get("fieldName"));a(".awe-item-preload",b.editingModel.view.$el).remove();b.closePanel()})},getFieldContent:function(c){var b=this,e=b.editingModel.get("fieldName").replace(/_/g,"-"),d=a(".field-name-"+e,c);if(!d.data("second-load")){b.editingModel.view.$el.prepend('<div class="awe-item-preload"></div>')}a.ajax({url:AWEContent.Path.drupalElementURL,type:"POST",data:{formData:c.serialize(),fieldName:b.editingModel.get("fieldName"),type:"drupal_field",nodeType:a("#edit-actions input[clicked=true]",c).data("node-type")},success:function(f){if(f.status){if(a(".ckeditor-mod",d).length&&!d.data("second-load")){b.getFieldContent(c);d.data("second-load",1)}else{c.trigger("getFieldContentSuccess",f);d.data("second-load",0)}}else{a(".ac-form-messages",b.$el).html(f.error)}}})},initPanel:function(){a('<div class="ac-form-messages"></div>').insertAfter(a(".md-section",this.$el).prev())},openPanel:function(){AWEContent.Views.ItemPanel.prototype.openPanel.call(this);var c=this,b=a(".node-form",this.$el),d=this.editingModel.get("fieldName").replace(/_/g,"-");this.$el.addClass(this.className);this.resetNodeForm(b);a("> div > .form-item, > div > .form-wrapper:not(.form-actions), .vertical-tabs, .awe-control-buttons",b).hide();a(".field-name-"+d,b).show();a("#edit-actions input:not(#edit-view-field)",b).hide();a("#edit-actions input#edit-view-field",b).show();this.$el.addClass("large-panel")},closePanel:function(){AWEContent.Views.ItemPanel.prototype.closePanel.call(this);this.$el.removeClass("large-panel");this.resetNodeForm(a("form",this.$el))},resetNodeForm:function(b){a("> div > .form-item, > div > .form-wrapper, .vertical-tabs, .awe-control-buttons",b).show();a("#edit-actions input:not(#edit-view-field)",b).show();a("#edit-actions input#edit-view-field",b).hide();a(".ac-form-messages",this.$el).html("")},buildPanel:function(){return{wrapper:{type:"section"}}}});a(document).ready(function(){AWEContent.Controllers.drupal_field=new AWEContent.Views.DrupalFieldController();AWEContent.Panels.drupal_field=new AWEContent.Views.DrupalFieldPanel()})})(jQuery);