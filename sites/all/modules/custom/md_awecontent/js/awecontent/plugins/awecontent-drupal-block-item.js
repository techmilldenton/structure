(function(a){AWEContent.Models.DrupalBlockItem=AWEContent.Models.Item.extend({defaults:{machine_name:"drupal_block",module:"",delta:"",info:"",customTitle:"",customID:"",customClass:"",boxModelSettings:{},enableAnimation:0,animationData:'{"type": "none"}',lgResponsive:true,xsResponsive:true,mediumResponsive:true,smResponsive:true},relations:[{type:Backbone.HasOne,key:"boxModelSettings",relatedModel:AWEContent.Models.BoxModelSettings}],createView:function(){this.view=new AWEContent.Views.DrupalBlockItem({model:this})},removePanelView:function(){var b=this.get("module")+"-"+this.get("delta");AWEContent.Toolbars.drupal.showController(b);AWEContent.Models.Item.prototype.removePanelView.call(this)}});AWEContent.Views.DrupalBlockController=AWEContent.Views.ItemController.extend({machineName:"drupal_block",el:"li.ac-dp-block",existingElement:true,createItemModel:function(d){if(d){var c=d.module+"-"+d.delta,b=a.inArray(c,AWEContent.Toolbars.loadedElements);if(b>-1){d.delta="invisible";d.module="undefined"}return new AWEContent.Models.DrupalBlockItem(d)}return null}});AWEContent.Views.DrupalBlockItem=AWEContent.Views.Item.extend({initialize:function(){AWEContent.Views.Item.prototype.initialize.call(this);this.listenTo(this.model.get("boxModelSettings"),"change",this.applySettingsChanged)},renderItemContent:function(){var b=this,c=this.model.toJSON();b.$el.addClass("awe-drupal-block-item");if(b.model.get("module")!="undefined"){b.loadBlockContent()}else{b.$el.prepend('<div class="block-content-unload">This block is used in another place on this page.</div>');b.$el.addClass("awe-item-unload")}if(!c.xsResponsive){this.$el.addClass("xs-hidden")}if(!c.smResponsive){this.$el.addClass("sm-hidden")}if(!c.mediumResponsive){this.$el.addClass("md-hidden")}this.$el.defaultResponsive(c)},loadBlockContent:function(){var b=this;a("> .block",b.el).remove();b.$el.prepend('<div class="awe-item-preload"></div>');a.post(AWEContent.Path.drupalElementURL,{type:this.model.get("machine_name"),module:this.model.get("module"),delta:this.model.get("delta"),custom_title:this.model.get("customTitle")},function(d){if(d.status){var i=b.model.get("module")+"-"+b.model.get("delta"),g=b.model.toJSON();b.$el.prepend(d.blockContent);a(".block",b.$el).addClass("awe-item");if(g.customID){a(".block",b.$el).attr("id",g.customID)}if(g.customClass){a(".block",b.$el).addClass(g.customClass)}a(".block",b.$el).renderItemDefaultBoxModel(g.boxModelSettings);if(g.enableAnimation){a(".block",b.$el).processAnimations(g.animationData)}a(".awe-item-preload",b.$el).remove();AWEContent.Toolbars.drupal.hideController(i);if(d.css&&d.css.length){a.each(d.css,function(){var j=(a.type(this)=="string")?a('<link type="text/css" rel="stylesheet" href=""/>').attr("href",this):a("<style />").html(this.data);AWEContent.jqIframe("head").append(j)})}if(d.js&&d.js.length){var e=0,h=0,f=[];a.each(d.js,function(){var j=AWEContent.documentIframe.createElement("script");j.setAttribute("type","text/javascript");if(a.type(this)=="string"){j.setAttribute("src",this);h++;j.onload=function(k){e++};AWEContent.documentIframe.getElementsByTagName("head")[0].appendChild(j)}else{j.innerHTML=this.data;f.push(j)}});if(f.length){var c=setInterval(function(){if(e==h){clearInterval(c);a.each(f,function(){AWEContent.documentIframe.getElementsByTagName("head")[0].appendChild(this)})}},100)}}}})},applySettingsChanged:function(c){var b=this,d=a(".block",b.el);a.each(c.changedAttributes(),function(f,i){b.$el.changeResponsive(f,i);switch(f){case"customTitle":if(a("> h2",d).length){a("> h2",d).html(i)}else{b.loadBlockContent()}break;case"customID":a(".block",b.el).attr("id",i);break;case"customClass":var h=c.previousAttributes().customClass;if(h){a(".block",b.$el).removeClass(h)}d.addClass(i);break;case"customEnableAnimations":var g,e;if(i){g=c.toJSON().customDataAnimations;e=null;d.processAnimations(g)}else{g=null;e=c.toJSON().customDataAnimations;d.processAnimations(g,e)}break;case"customDataAnimations":var g,e;g=c.toJSON().customDataAnimations;e=b.model.previousAttributes().customDataAnimations;d.processAnimations(g,e);break;default:d.changeResponsive(f,i);d.renderChangeSettingBoxModel(f,i,c);break}})}});AWEContent.Views.DrupalBlockPanel=AWEContent.Views.DefaultPanel.extend({panelName:"drupal_block",className:"awe-obj-panel drupal-block-panel",initPanel:function(){var b=this;AWEContent.Views.DefaultPanel.prototype.initPanel.call(this);a("#text-drupal-block-custom-title",this.$el).change(function(){b.editingModel.set("customTitle",a(this).val())});a("#drupal-block-layout-tab",this.$el).initBoxModelPanel(this,"boxModelSettings");a("#text-drupal-block-custom-id",this.$el).change(function(){b.editingModel.set("customID",a(this).val())});a("#text-drupal-block-custom-classes",this.$el).change(function(){b.editingModel.set("customClass",a(this).val())});a("#drupal-block-animations",this.el).change(function(c,d){b.editingModel.set("enableAnimation",d.enabled);if(d){b.editingModel.set("animationData",d.animations)}})},setPanelElementsValue:function(){var b=this,c=this.editingModel.toJSON();a("#text-drupal-block-custom-title",b.el).val(c.customTitle);a("#drupal-block-layout-tab",b.el).initBoxModel(c.boxModelSettings);a("#drupal-block-animations",this.el).aweAnimation("value",{enabled:c.enableAnimation,animations:c.animationData,previewEl:b.editingModel.view.$el});a("#text-drupal-block-custom-id",b.el).val(c.customID);a("#text-drupal-block-custom-classes",b.el).val(c.customClass)},buildPanel:function(){return{title:{type:"markup",markup:'<div class="awe-title"><h2>Drupal Block</h2></div>'},box_settings:{type:"section",custom_title:{type:"text_field",title:"Title",placeholder:"Custom block title"},layout_tab:{type:"tabs",tabs:[{tab_title:"Border",contents:{header_border:{type:"box_border",min_value:0,max_value:100,default_value:0}}},{tab_title:"Radius",contents:{header_boder_radius:{type:"box_model",model_type:"border_radius",min_value:0,max_value:100,allow_type:true}}},{tab_title:"Padding",contents:{header_padding:{type:"box_model",model_type:"padding",allow_type:true,min_value:0,max_value:100}}},{tab_title:"Margin",contents:{header_margin:{type:"box_model",model_type:"margin",allow_type:true,min_value:0,max_value:100}}}]}},others:{type:"section",custom_id:{type:"text_field",title:"ID",placeholder:"Custom block ID"},custom_classes:{type:"text_field",title:"Class",placeholder:"Custom class"},animations:{type:"animations"}}}}});a(document).ready(function(){AWEContent.Controllers.drupal_block=new AWEContent.Views.DrupalBlockController();AWEContent.Panels.drupal_block=new AWEContent.Views.DrupalBlockPanel()})})(jQuery);