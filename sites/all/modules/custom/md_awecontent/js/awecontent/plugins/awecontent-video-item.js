(function(a){AWEContent.Models.VideoItem=AWEContent.Models.Item.extend({defaults:{machine_name:"video",linkVideo:"",linkProcessed:"",typeThumb:"auto",indexThumbAuto:0,srcThumbAuto:"",srcThumbCustom:"",thumbStyle:"none",typePlay:"inline",heightVideo:-1,backgroundColor:"",boxModelSettings:{},customID:"",customClass:"",customEnableAttributes:0,customDataAttributes:"[] ",customActionAttributes:'{"newAction": "", "newAttrName": "", "newAttrValue": ""}',customEnableAnimations:0,customDataAnimations:'{"type" : "none"}',lgResponsive:true,xsResponsive:true,mediumResponsive:true,smResponsive:true},relations:[{type:Backbone.HasOne,key:"boxModelSettings",relatedModel:AWEContent.Models.BoxModelSettings}],createView:function(){this.view=new AWEContent.Views.VideoItem({model:this})},clone:function(){var b={};a.each(this.toJSON(),function(c,d){b[c]=d});b.boxModelSettings=new AWEContent.Models.BoxModelSettings(b.boxModelSettings);return new AWEContent.Models.VideoItem(b)}});AWEContent.Views.VideoItem=AWEContent.Views.Item.extend({additionalEvents:{"click .thumb-video":"showIframe"},showIframe:function(e){var b=a(e.target).hasClass("thumb-video")?a(e.target):a(e.target).closest(".thumb-video"),f=b.nextAll("iframe"),d=b.nextAll("a"),c=this.model.toJSON();if(c.typePlay=="lightbox"){AWEContent.jqIframe(d).trigger("click")}else{if(c.typePlay=="inline"){b.hide();f.show().attr("src",this.model.toJSON().linkProcessed)}}},initialize:function(){AWEContent.Views.Item.prototype.initialize.call(this);this.listenTo(this.model.get("boxModelSettings"),"change",this.applySettingsChanged)},renderItemContent:function(){var c=this,e=c.model.toJSON(),d=a('<div class="awe-item awe-video"><div class="thumb-video"><div class="image-content"><img src="" alt=""/></div><div class="play-control"><i class="ic ac-icon-play"></i></div></div><a href="" class="mfp-md-video"></a><iframe class="" src=""></iframe></div>'),i=a("img",d),h=a("iframe",d),f=a("a",d);AWEContent.Library.addLibrary("magnific",function(){b()});f.attr("href",e.linkVideo);if(e.typeThumb=="auto"){i.attr("src",e.srcThumbAuto)}else{i.attr("src",e.srcThumbCustom)}if(e.typePlay=="autoInline"){i.closest(".thumb-video").hide();h.attr("src",e.linkProcessed).show()}d.css({height:e.heightVideo!=-1?e.heightVideo+"px":""});i.css("background-color",e.backgroundColor);d.attr("id",e.customID).addClass(e.customClass).renderItemDefaultAttributes(e.customEnableAttributes,e.customDataAttributes);d.renderItemDefaultBoxModel(e.boxModelSettings);if(e.customEnableAnimations){var g=e.customDataAnimations;d.processAnimations(g)}c.$el.defaultResponsive(e);function b(){AWEContent.jqIframe(f).magnificPopup({disableOn:700,prependTo:".awe-page-wrapper",type:"iframe",mainClass:"mfp-fade",removalDelay:160,preloader:false,fixedContentPos:false})}return d},applySettingsChanged:function(j){var l=this,c=a(".awe-video",l.el),f=a(".thumb-video",c),d=a("img, iframe",c),b=a("img",c),e=a("a",c),k=a("iframe",c),g=j.toJSON(),h,m,i=l.$el.height();a.each(j.changedAttributes(),function(o,r){l.$el.changeResponsive(o,r);c.renderChangeSettingBoxModel(o,r,j);switch(o){case"linkVideo":e.attr("href",r);break;case"linkProcessed":if(g.typePlay=="autoInline"){k.attr("src",r)}else{k.attr("src","");f.show()}break;case"typeThumb":if(r=="auto"){b.attr("src",g.srcThumbAuto)}else{b.attr("src",g.srcThumbCustom)}break;case"srcThumbAuto":if(g.typeThumb=="auto"){b.attr("src",r)}break;case"thumbStyle":var t=g.fidThumbCustom,p=g.thumbStyle;if(t){a.ajax({type:"POST",url:AWEContent.Path.imageStyleURL,data:{fids:""+t,styles:p},success:function(u){l.model.set("srcThumbCustom",u[t][p]);AWEContent.Panels.video.$el.find("#video-upload-thumbnail .image-content").attr("src",u[t][p])}})}break;case"srcThumbCustom":if(g.typeThumb=="custom"){b.attr("src",r)}break;case"typePlay":if(r=="autoInline"){f.hide();k.show().attr("src",g.linkProcessed)}else{f.show();k.hide().attr("src","")}break;case"heightVideo":c.css("height",r!=-1?r+"px":"");break;case"backgroundColor":f.css("background",r);break;case"customID":c.attr("id",r);break;case"customClass":var s=l.model.previousAttributes().customClass;c.removeClass(s).addClass(r);break;case"customEnableAttributes":c.renderChangeSettingsAttributes(o,r,g.customDataAttributes);break;case"customActionAttributes":c.renderChangeSettingsAttributes(o,r);break;case"customEnableAnimations":var q,n;if(r){q=g.customDataAnimations;n=null;c.processAnimations(q)}else{q=null;n=g.customDataAnimations;c.processAnimations(q,n)}break;case"customDataAnimations":var q,n;q=g.customDataAnimations;n=l.model.previousAttributes().customDataAnimations;c.processAnimations(q,n);break}});setTimeout(function(){l.checkChangeHeight(i)},50)}});AWEContent.Views.VideoItemController=AWEContent.Views.ItemController.extend({machineName:"video",controllerHtml:function(){return'<div class="title-icon">Video</div><i class="ic ac-icon-video"></i>'},createItemModel:function(b){var c;if(b!=undefined){c=new AWEContent.Models.BoxModelSettings(b.boxModelSettings);b.boxModelSettings=c;return new AWEContent.Models.VideoItem(b)}return new AWEContent.Models.VideoItem({boxModelSettings:new AWEContent.Models.BoxModelSettings()})}});AWEContent.Views.VideoPanel=AWEContent.Views.ItemPanel.extend({tagName:"div",className:"awe-obj-panel video-panel",panelName:"video",initPanel:function(){AWEContent.Views.ItemPanel.prototype.initPanel.call(this);var b=this;a(".thumb-container",b.el).attr("id","video-upload-thumbnail").aweUploadImageInit();a(".slide-image-container",b.el).attr("id","video-slide-thumbnail").aweSlideImageInit();a(".color-picker",b.el).append('<input type="hidden" name="changing-color">');a("#text-video-link-video",b.el).change(function(){var c=a.processVideo(a(this).val()),d=c.attrVideo.replace("autoplay=0","autoplay=1");b.editingModel.set("linkVideo",a(this).val());b.editingModel.set("linkProcessed",d);a("#video-slide-thumbnail input[name=custom_image]",b.el).val(0).trigger("change")});a("#video-select-thumb",b.el).change(function(d,c){b.editingModel.set("typeThumb",c.value);if(c.value=="auto"){a("#video-slide-thumbnail",b.el).show();a("#video-upload-thumbnail",b.el).hide()}else{a("#video-slide-thumbnail",b.el).hide();a("#video-upload-thumbnail",b.el).show()}});a("#video-slide-thumbnail input[name=custom_image]",b.el).change(function(d,n){var i=parseInt(a(this).val()),m=a(this).closest(".slide-image-container"),h=b.editingModel.get("linkVideo"),j=a.processVideo(h),e=j.id.trim(),f=j.typeVideo,k=a(this).closest(".slide-image-container").prev("#video-select-thumb"),c=a("input[name=selected_value]",k).val(),l=a(this).prev(".slide-image-controls");a("img",m).removeClass("active");if(f=="youtube"){l.show();a.each(a("img",m),function(){var o=a(this).index();if(e!=""){a(this).attr("src","http://img.youtube.com/vi/"+e+"/"+o+".jpg")}else{a(this).attr("src","http://img.youtube.com/vi/"+o+".jpg")}});var g=a("img",m).eq(i).addClass("active").attr("src");a("img",m).eq(i).addClass("active");b.editingModel.set("indexThumbAuto",i);b.editingModel.set("srcThumbAuto",g)}else{if(f=="vimeo"){a.ajax({type:"GET",url:"http://vimeo.com/api/v2/video/"+e+".json",jsonp:"callback",dataType:"jsonp",success:function(o){l.hide();var p=o[0].thumbnail_large;b.editingModel.set("indexThumbAuto",0);b.editingModel.set("srcThumbAuto",p);a("img",m).eq(0).attr("src",p).addClass("active")}})}}});a("#video-upload-thumbnail input[name=selected_media]",b.el).change(function(e){var g,c=a(this).prev().find("img"),f=a(this).val(),d=b.editingModel.get("thumbStyle");if(f!=""){f=a.parseJSON(f);if(AWEContent.Path.imageStyleURL!=""){a.ajax({type:"POST",url:AWEContent.Path.imageStyleURL,data:{fids:""+f.fid,styles:d},success:function(h){if(a.type(h)=="string"){h=JSON.parse(h.trim())}g=h[f.fid][d];b.editingModel.set({srcThumbCustom:g,fidThumbCustom:f.fid});c.attr("src",g)}})}else{g=f.file_url;b.editingModel.set("srcThumbCustom",g);c.attr("src",g)}}});a("#video-thumb-style",this.el).change(function(d,c){b.editingModel.set("thumbStyle",c.value)});a("#video-play-video",b.el).change(function(d,c){b.editingModel.set("typePlay",c.value)});a("#video-height-video",b.el).change(function(d,c){b.editingModel.set("heightVideo",c.value);if(c.value==-1){a(".display-font",a(this)).text("DF")}});a("#video-background-color",b.el).change(function(d,c){if(c){c=c.toRgbString()}else{c=""}b.editingModel.set("backgroundColor",c)});a("#video-layout-tab",b.el).initBoxModelPanel(b,"boxModelSettings");a("#text-video-custom-id",this.el).change(function(){b.editingModel.set("customID",a(this).val())});a("#text-video-custom-classes",this.el).change(function(){b.editingModel.set("customClass",a(this).val())});a("#video-custom-attributes",this.el).initAttributesPanel(b);a("#video-animations",this.el).change(function(c,d){b.editingModel.set("customEnableAnimations",d.enabled);if(d){b.editingModel.set("customDataAnimations",d.animations)}})},setPanelElementsValue:function(){var b=this,c=this.editingModel.toJSON();a("#text-video-link-video",b.el).val(c.linkVideo).trigger("change");a("#video-select-thumb",b.el).aweSelect("value",c.typeThumb);a("#video-slide-thumbnail input[name=custom_image]",b.el).val(c.indexThumbAuto).trigger("change",{isCustom:true});a("#video-upload-thumbnail .image-content",b.el).attr("src",c.srcThumbCustom);if(AWEContent.Path.imageStyleURL!=""){a("#video-thumb-style",b.el).aweSelect("value",c.thumbStyle)}else{a("#video-thumb-style",b.el).remove()}a("#video-play-video",b.el).aweSelect("value",c.typePlay);a("#video-height-video",b.el).aweSlider("value",c.heightVideo);a("#video-background-color",b.el).aweColorPicker("value",c.backgroundColor);a("#video-layout-tab",b.el).initBoxModel(c.boxModelSettings);a("#text-video-custom-id",b.el).val(c.customID);a("#text-video-custom-classes",b.el).val(c.customClass);a("#video-custom-attributes input[name=enabled_custom_attributes]",b.el).val(c.customEnableAttributes).trigger("change");a("#video-custom-attributes input[name=attributes_data]",b.el).val(c.customDataAttributes);a("#video-custom-attributes",this.el).initAttributes(c.customEnableAttributes,c.customDataAttributes);a("#video-animations",this.el).aweAnimation("value",{enabled:c.customEnableAnimations,animations:c.customDataAnimations,previewEl:b.editingModel.view.$el})},buildPanel:function(){return{title:{type:"markup",markup:'<div class="awe-title"><h2>Video</h2></div>'},"information-video":{type:"section",link_video:{type:"text_field",title:"Link",placeholder:"http://...",default_value:""},select_thumb:{type:"select",title:"Thumb",options:{auto:"Auto",custom:"Custom"},default_value:"custom"},slider_thumbnail:{type:"markup",markup:'<div class="slide-image-container"><div class="list-image"><img src="" alt=""/><img src="" alt=""/><img src="" alt=""/><img src="" alt=""/></div><div class="slide-image-controls"><i class="nav-prev ic ac-icon-arrow-left"></i><i class="nav-next ic ac-icon-arrow-right"></i></div><input type="hidden" name="custom_image" value=""/></div>'},upload_thumbnail:{type:"markup",markup:'<div class="thumb-container"><div class="controls-upload ic ac-icon-upload"></div><div class="image-container"><img class="image-content" src="" alt=""/><div class="remove-image ic ac-icon-clear"></div></div><input type="hidden" name="selected_media" value=""/></div>'},thumb_style:{type:"image_style_list",title:"Thumbnail Style",default_value:"none",attributes:{"class":["long-title"]}},play_video:{type:"select",title:"Play",options:{autoInline:"Auto play inline",inline:"Inline",lightbox:"Play in lightbox"},default_value:"inline"},height_video:{type:"slider",title:"Height",min_value:-1,max_value:1000,unit:"px",default_value:20,allow_type:true},background_color:{type:"colorpicker",title:"Background color",options:{preferredFormat:"rgb",AlphaVerticle:true,showAlpha:true,allowEmpty:true,showInput:true}}},box_settings:{type:"section",layout_tab:{type:"tabs",tabs:[{tab_title:"Border",contents:{video_border:{type:"box_border",min_value:0,max_value:100,default_value:0}}},{tab_title:"Radius",contents:{video_boder_radius:{type:"box_model",model_type:"border_radius",min_value:0,max_value:100,allow_type:true}}},{tab_title:"Padding",contents:{video_padding:{type:"box_model",model_type:"padding",allow_type:true,min_value:0,max_value:100}}},{tab_title:"Margin",contents:{video_margin:{type:"box_model",model_type:"margin",allow_type:true,min_value:0,max_value:100}}}]}},definitions:{type:"section",custom_id:{type:"text_field",title:"ID",default_value:"ID"},custom_classes:{type:"text_field",title:"Classes",default_value:""},custom_attributes:{type:"custom_attributes"},animations:{type:"animations"}}}}});a(document).ready(function(){AWEContent.Controllers.video=new AWEContent.Views.VideoItemController();AWEContent.Panels.video=new AWEContent.Views.VideoPanel()})})(jQuery);