!function(e){var t=.07,i=7,a=218,n='<div class="mdf-item">      <div class="mdi-view"><a href="#" class="btn-viewlayer"></a></div><div class="mdi-name">    <span class="mdit-type">[image]</span>    <span class="title"></span>    <a href="#" class="btn-deletelayer"></a>    <a href="#" class="btn-clonelayer"></a></div>    <div class="mdtl-times"><div class="mdi-frame"></div></div></div>';MegaSlider.Timeline=function(e){this.panel=e},MegaSlider.Timeline.prototype={constructor:MegaSlider.Timeline,init:function(){var n=this;e("#mdf-timeline").tinyscrollbar(),e("#slideshow-time").css("left",6e3*t),e("#timeline-items").width(6e3*t+a),e(document).on("click","a.btn-viewlayer",function(){var t=e(this).parent().parent(),i=t.data("box");return null!=i&&(e(this).hasClass("active")?(i.show(),i.attr("ishidden","false"),t.removeClass("box-hide"),e(this).removeClass("active")):(i.hide(),i.attr("ishidden","true"),i.removeClass("ui-selected"),t.addClass("box-hide"),n.panel.triggerChangeSelectItem(),e(this).addClass("active"))),!1}),e(document).on("click","a.btn-deletelayer",function(){var t=e(this).parent().parent(),i=t.data("box");return null!=i&&(t.remove(),i.remove(),n.panel.triggerChangeSelectItem()),!1}),e(document).on("click","a.btn-clonelayer",function(){var t=e(this).parent().parent(),i=t.data("box");return null!=i&&n.panel.cloneBoxItem(i),!1}),e("#timeline-items").sortable({handle:".mdi-name",update:function(e,t){n.triggerChangeOrderItem()},placeholder:"mdf-item"}),e("#slideshow-time").draggable({axis:"x",grid:[i,20],containment:"parent",drag:function(e,t){return t.position.left<=n.maxStart+i?!1:n.updateTimelineWidth()}})},changeSelectItem:function(e){this.selectedItem=e,this.triggerChangeSelectItem()},triggerChangeSelectItem:function(){if(e("#timeline-items > div.mdf-item.active").removeClass("active"),null!=this.selectedItem){var t=this.selectedItem.data("timeline");null!=t&&e(t).addClass("active")}},setTimelineWidth:function(i){i&&(e("#slideshow-time").css("left",i*t),this.updateTimelineWidth())},updateTimelineWidth:function(){var i=this,n=e("#slideshow-time").position().left;return this.panel.setTimelineWidth(Math.round(n/t)),e("#timeline-items").width(a+n),e("#timeline-items .mdf-item").each(function(){var a=e(this).find(".mdi-frame"),l=e(this).data("box");null!=l&&a.position().left+a.width()>n&&(a.width(n-a.position().left),l.data("stoptime",n/t),i.panel.changeTimelineValue())}),!0},addTimelineItem:function(l,s){var d=e(n).clone(),m=this;d.find(".mdit-type").html("["+l+"]");var r=s.data("title");d.find("span.title").html(r);var h=s.data("starttime")?s.data("starttime"):0,c=s.data("stoptime")?s.data("stoptime"):Math.round((e("#timeline-items").width()-a)/t);c>h&&(d.find("div.mdi-frame").css({left:h*t,width:(c-h)*t}),(null==s.data("starttime")||null==s.data("stoptime"))&&(s.data("starttime",h),s.data("stoptime",c),this.panel.changeTimelineValue())),d.data("box",s),e("#timeline-items").prepend(d),d.find("div.mdi-frame").draggable({containment:"parent",grid:[i,20],stop:function(i,a){var n=e(this).parent().parent(),l=n.data("box");if(null!=l){var s=e(a.helper).position();l.data("starttime",Math.round(s.left/t)),l.data("stoptime",Math.round((s.left+e(a.helper).width())/t)),l.hasClass("ui-selected")&&m.panel.triggerChangeSettingItem()}m.changeMaxStart()}}),d.find("div.mdi-frame").resizable({handles:"e, w",containment:"parent",minWidth:2*i,grid:[i,20],stop:function(i,a){var n=e(this).parent().parent(),l=n.data("box");if(null!=l){var s=e(a.helper).position();l.data("starttime",Math.round(s.left/t)),l.data("stoptime",Math.round((s.left+e(a.helper).width())/t)),l.hasClass("ui-selected")&&m.panel.triggerChangeSettingItem()}m.changeMaxStart()}}),d.click(function(){if(!e(this).hasClass("active")&&!e(this).hasClass("box-hide")){var t=e(this).data("box");null!=t&&m.panel.changeSelectItem(t)}}),s.data("timeline",d),e("#mdf-timeline").tinyscrollbar_update("relative")},changeMaxStart:function(){var t=0;e("#timeline-items .mdtl-times").each(function(){var i=e(this).find("div.mdi-frame").position().left;i>t&&(t=i)}),this.maxStart=t},changeSelectItem:function(e){this.selectedItem=e,this.triggerChangeSelectItem()},triggerChangeSelectItem:function(){if(e("#timeline-items > div.mdf-item.active").removeClass("active"),null!=this.selectedItem){var t=this.selectedItem.data("timeline");null!=t&&e(t).addClass("active")}},triggerChangeOrderItem:function(){e("#timeline-items .mdf-item").each(function(t){var i=e(this).data("box");null!=i&&(i.data("zindex",1e3-t),i.css("z-index",1e3-t))})},changeSelectedItemTitle:function(){if(null!=this.selectedItem){var t=this.selectedItem.data("timeline");if(null!=t){var i=this.selectedItem.data("title");e(t).find("span.title").html(i)}}},setTimelineWidth:function(i){i&&(e("#slideshow-time").css("left",i*t),this.updateTimelineWidth())},changeActivePanel:function(){e("#timeline-items").html("");var i=this.panel.getTimelineWidth();null!=i?this.setTimelineWidth(i):this.panel.setTimelineWidth(e("#slideshow-time").position().left/t);var a=this.panel.getAllItemBox();a.sort(function(t,i){var a=parseInt(e(t).data("zindex")),n=parseInt(e(i).data("zindex"));return n>a?-1:a>n?1:0});var n=this;a.each(function(){n.addTimelineItem(e(this).data("type"),e(this))})}}}(jQuery);